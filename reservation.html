<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>R√©server votre karaok√© box √† Toulouse | Singbox</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- SEO -->
  <meta name="description" content="R√©servez facilement votre karaok√© box privative √† Toulouse chez Singbox. Choisissez votre date, votre box (Nuit √©toil√©e ou Ambiance Sunset) et un cr√©neau libre de 1h30, avec tarifs dynamiques selon le jour et l‚Äôhoraire." />
  <meta name="robots" content="index,follow" />
  <meta name="keywords" content="karaoke toulouse, karaok√© toulouse, karaoke box toulouse, karaok√© privatif toulouse, r√©server karaok√© toulouse, singbox, nuit √©toil√©e, ambiance sunset" />
  <link rel="canonical" href="https://www.singbox.fr/reservation" />

  <!-- Open Graph / Facebook -->
  <meta property="og:title" content="R√©server votre karaok√© box √† Toulouse | Singbox" />
  <meta property="og:description" content="R√©servez votre box de karaok√© privative √† Toulouse (Nuit √©toil√©e ou Ambiance Sunset) pour une session de 1h30. Cr√©neaux dynamiques, tarifs selon l‚Äôhoraire et ajout imm√©diat au panier." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://www.singbox.fr/reservation" />
  <meta property="og:site_name" content="Singbox" />
  <meta property="og:image" content="https://www.singbox.fr/images/singbox-social.png" />

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="R√©server votre karaok√© box √† Toulouse | Singbox" />
  <meta name="twitter:description" content="R√©servez votre karaok√© box privative √† Toulouse en quelques clics chez Singbox : sessions de 1h30, deux ambiances, tarifs dynamiques et r√©servation 100% en ligne." />
  <meta name="twitter:image" content="https://www.singbox.fr/images/singbox-social.png" />

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="favicon.png">
  <link rel="apple-touch-icon" href="favicon.png">

  <!-- Donn√©es structur√©es LocalBusiness -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "EntertainmentBusiness",
    "name": "Singbox",
    "image": "https://www.singbox.fr/logo.png",
    "@id": "https://www.singbox.fr/",
    "url": "https://www.singbox.fr/",
    "telephone": "+33 6 00 00 00 00",
    "address": {
      "@type": "PostalAddress",
      "streetAddress": "66 Rue de la R√©publique",
      "postalCode": "31300",
      "addressLocality": "Toulouse",
      "addressCountry": "FR"
    },
    "priceRange": "‚Ç¨‚Ç¨",
    "description": "Karaok√© box privatif √† Toulouse : r√©servez des salons enti√®rement insonoris√©s pour chanter entre amis, en famille ou entre coll√®gues.",
    "sameAs": [
      "https://www.instagram.com/singboxtoulouse/",
      "https://www.tiktok.com/@singbox.toulouse/"
    ]
  }
  </script>

  <!-- Donn√©es structur√©es WebPage -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebPage",
    "name": "R√©server votre karaok√© box √† Toulouse | Singbox",
    "url": "https://www.singbox.fr/reservation",
    "description": "R√©servez votre karaok√© box privative √† Toulouse chez Singbox. Choisissez votre date, votre box (Nuit √©toil√©e ou Ambiance Sunset) et un cr√©neau libre de 1h30, avec tarifs dynamiques selon le jour et l‚Äôhoraire.",
    "inLanguage": "fr-FR",
    "isPartOf": {
      "@type": "WebSite",
      "name": "Singbox",
      "url": "https://www.singbox.fr"
    }
  }
  </script>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=League+Spartan:wght@600;700;800&family=Montserrat:wght@300;400;500;600&display=swap"
    rel="stylesheet"
  >

  <style>
    :root {
      --sb-bg-main: #050814;
      --sb-bg-deep: #020617;
      --sb-card: #050b18;
      --sb-text-main: #F9FAFB;
      --sb-text-muted: #9CA3AF;
      --sb-red: #C94C35;
      --sb-orange: #F97316;
      --sb-border-soft: rgba(148, 163, 184, 0.35);
      --sb-container-width: 1180px;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: "Montserrat", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: var(--sb-text-main);
      background:
        radial-gradient(circle at 10% 0%, rgba(107,18,32,0.65), transparent 55%),
        radial-gradient(circle at 80% 10%, rgba(30,64,175,0.7), transparent 60%),
        linear-gradient(145deg, #020617 0, #020617 40%, var(--sb-bg-main) 100%);
      min-height: 100vh;
    }

    a { text-decoration: none; color: inherit; }

    h1, h2, h3 {
      font-family: "League Spartan", system-ui, sans-serif;
      letter-spacing: 0.03em;
      margin: 0;
    }

    .container {
      max-width: var(--sb-container-width);
      margin: 0 auto;
      padding: 0 1.5rem;
    }

    /* ======================= HEADER GLOBAL ======================= */

    .site-header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 50;
      background: #020617;
      color: #fff;
      box-shadow: 0 14px 30px rgba(0,0,0,0.75);
    }

    .header-inner {
      max-width: var(--sb-container-width);
      margin: 0 auto;
      padding: 12px 24px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 2rem;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 12px;
      text-decoration: none;
      flex-shrink: 0;
    }

    .brand-logo {
      width: 110px;
      height: auto;
      border-radius: 999px;
      display: block;
      object-fit: contain;
      filter:
        drop-shadow(0 0 12px rgba(255,255,255,0.16))
        drop-shadow(0 0 20px rgba(201,76,53,0.6));
    }

    .brand-text {
      font-family: "League Spartan", system-ui, sans-serif;
      font-weight: 600;
      letter-spacing: 0.15em;
      font-size: 26px;
      color: #F9FAFB;
      text-transform: uppercase;
      white-space: nowrap;
      display: flex;
      align-items: center;
    }

    nav.main-nav {
      flex: 1;
      display: flex;
      justify-content: center;
      min-width: 0;
    }

    .main-nav ul {
      list-style: none;
      display: flex;
      gap: 32px;
      margin: 0;
      padding: 0;
      font-size: 14px;
    }

    .main-nav a {
      font-weight: 600;
      letter-spacing: 0.3px;
      color: #ffffff;
      text-decoration: none;
      position: relative;
      padding-bottom: 4px;
      white-space: nowrap;
    }

    .main-nav a::after {
      content: "";
      position: absolute;
      left: 0;
      bottom: 0;
      height: 2px;
      width: 0;
      background: linear-gradient(90deg, #ff6930, #ffb96f);
      border-radius: 6px;
      transition: width 0.3s ease;
    }

    .main-nav a:hover::after { width: 100%; }

    .main-nav a:hover {
      color: #ffb96f;
      transition: 0.25s ease;
    }

    .main-nav a[href="reservation.html"]::after { width: 100%; }

    .header-actions {
      display: flex;
      align-items: center;
      gap: 12px;
      flex-shrink: 0;
    }

    .nav-cta {
      background: var(--sb-red);
      padding: 8px 22px;
      border-radius: 999px;
      font-weight: 600;
      font-size: 14px;
      color: #F9FAFB;
      white-space: nowrap;
      box-shadow:
        0 0 0 1px rgba(249,250,251,0.08),
        0 10px 28px rgba(0,0,0,0.7);
      transition: background 0.15s ease, transform 0.15s ease, box-shadow 0.15s ease;
    }

    .nav-cta:hover {
      background: #d55a40;
      transform: translateY(-1px);
      box-shadow:
        0 0 0 1px rgba(249,250,251,0.18),
        0 16px 38px rgba(0,0,0,0.9);
    }

    .cart-icon {
      width: 36px;
      height: 36px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.25);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      cursor: pointer;
      position: relative;
      background: radial-gradient(circle at 30% 0%, rgba(248,250,252,0.16), rgba(15,23,42,0.85));
      backdrop-filter: blur(6px);
    }

    #cart-count {
      position: absolute;
      top: -6px;
      right: -6px;
      background: var(--sb-orange);
      color:#fff;
      border-radius:999px;
      font-size:10px;
      padding: 2px 5px;
      min-width: 18px;
      text-align:center;
    }
    #cart-count:empty { display:none; }

    .burger-button {
      display: none;
      width:36px;
      height:36px;
      border-radius:999px;
      border:1px solid #ffffff33;
      background:transparent;
      color:#fff;
      align-items:center;
      justify-content:center;
      cursor:pointer;
      font-size:20px;
    }

    .mobile-nav {
      display:none;
      position:fixed;
      top:80px;
      left:0;
      right:0;
      background:#020617;
      padding:12px 24px 16px;
      z-index:40;
      border-bottom:1px solid #111827;
    }
    .mobile-nav ul {
      list-style:none;
      padding:0;
      margin:0;
      display:flex;
      flex-direction:column;
      gap:12px;
      font-size:15px;
    }
    .mobile-nav a { color:#fff; }
    .mobile-nav.open { display:block; }

    @media screen and (max-width: 1024px) {
      .header-inner { padding: 10px 16px; gap: 12px; }
      .main-nav { display: none !important; }
      .nav-cta { display: none !important; }
      .brand-text { display: none !important; }
      .burger-button { display: flex !important; }
      .brand-logo { width: 72px; }
    }

    @media (max-width: 640px) {
      .brand-logo { width: 64px; }
    }

    /* ---------- HERO R√âSERVATION ---------- */
    .hero-resa {
      position: relative;
      padding: 12rem 0 3.25rem;
      background:
        radial-gradient(circle at 25% 0%, rgba(201,76,53,0.35), transparent 55%),
        radial-gradient(circle at 80% 0%, rgba(37,99,235,0.45), transparent 60%),
        #050814;
      text-align: center;
      overflow: hidden;
    }

    .hero-inner {
      max-width: 640px;
      margin: 0 auto;
      padding: 0 1.5rem;
      color: var(--sb-text-main);
    }

    .hero-eyebrow {
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: #9CA3AF;
      margin-bottom: 10px;
    }

    .hero-resa h1 {
      margin:0 0 10px;
      font-size: 30px;
    }

    .hero-resa p {
      margin:0;
      font-size:14px;
      color: rgba(249,250,251,0.85);
    }

    main {
      padding: 0 0 4rem;
      background: #050814;
    }

    .resa-wrapper { padding-top: 2.5rem; }

    .resa-card {
      background: var(--sb-card);
      border-radius: 24px;
      padding: 2rem 2rem 2.25rem;
      box-shadow: 0 22px 60px rgba(0,0,0,0.9);
      border: 1px solid rgba(255,255,255,0.06);
      position: relative;
      overflow: hidden;
    }

    .resa-card::after {
      content: "üé§";
      position: absolute;
      right: 18px;
      bottom: 16px;
      font-size: 30px;
      color: rgba(148,163,184,0.1);
      pointer-events: none;
    }

    .resa-card h2 {
      font-size: 20px;
      margin-bottom: 0.75rem;
    }

    /* ===== HEADER FORM ===== */
    .resa-header {
      display: flex;
      flex-wrap: wrap;
      gap: 1.75rem;
      align-items: flex-end;
      margin-bottom: 0.4rem;
    }

    .resa-field {
      display: flex;
      flex-direction: column;
      gap: 6px;
      font-size: 13px;
      color: #E5E7EB;
    }

    .resa-field-date { flex: 1; min-width: 0; }
    .resa-field-persons { width: 230px; }
    .resa-button-wrapper { margin-left: auto; }

    .resa-label-inline {
      display: flex;
      gap: 4px;
      align-items: baseline;
      font-size: 13px;
    }

    .resa-indicator {
      font-size: 12px;
      color: var(--sb-text-muted);
    }

    #date-input {
      padding: 0.55rem 0.8rem;
      border-radius: 999px;
      border: 1px solid var(--sb-border-soft);
      background: #020617;
      color: #F9FAFB;
      font-size: 13px;
      outline: none;
      min-width: 180px;
      max-width: 260px;
    }

    #date-input::-webkit-calendar-picker-indicator { filter: invert(1); }

    .resa-persons-select {
      padding: 0.45rem 0.8rem;
      border-radius: 999px;
      border: 1px solid var(--sb-border-soft);
      background: #020617;
      color: #F9FAFB;
      font-size: 13px;
      outline: none;
      min-width: 180px;
    }

    .resa-header button {
      border: none;
      border-radius: 999px;
      padding: 0.65rem 1.4rem;
      background: linear-gradient(90deg, var(--sb-red), var(--sb-orange));
      color: #F9FAFB;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      box-shadow:
        0 0 0 1px rgba(248,250,251,0.12),
        0 14px 30px rgba(0,0,0,0.85);
      transition: transform 0.15s ease, box-shadow 0.15s ease, filter 0.15s ease;
      white-space: nowrap;
      align-self: center;
    }

    .resa-header button:hover {
      transform: translateY(-1px);
      filter: brightness(1.05);
      box-shadow:
        0 0 0 1px rgba(248,250,251,0.18),
        0 20px 50px rgba(0,0,0,1);
    }

    .resa-note {
      font-size: 12px;
      color: var(--sb-text-muted);
      margin-top: 4px;
    }

    @media (max-width: 900px) {
      .resa-header { flex-direction: column; align-items: flex-start; }
      .resa-field-persons, .resa-button-wrapper { width: 100%; }
      .resa-header button { width: 100%; text-align: center; }
    }

    .table-wrapper {
      margin-top: 1rem;
      border-radius: 18px;
      overflow: hidden;
      border: 1px solid rgba(148,163,184,0.35);
      background: #020617;
      box-shadow: inset 0 0 0 1px rgba(15,23,42,0.8);
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }

    .table-scroll-hint {
      font-size: 11px;
      color: var(--sb-text-muted);
      margin-top: 0.5rem;
      margin-bottom: 0.1rem;
      text-align: right;
      display: none;
    }

    .table-scroll-hint .arrow {
      font-size: 14px;
      margin-left: 4px;
    }

    @media (max-width: 768px) {
      .table-scroll-hint { display: block; }
    }

    table {
      border-collapse: collapse;
      width: 100%;
      min-width: 640px;
      color: #F9FAFB;
      table-layout: fixed;
    }

    th, td {
      padding: 0.55rem 0.6rem;
      text-align: center;
      font-size: 12px;
      border-bottom: 1px solid rgba(31,41,55,0.9);
      border-right: 1px solid rgba(31,41,55,0.9);
      white-space: nowrap;
    }

    th:last-child, td:last-child { border-right: none; }

    th {
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #E5E7EB;
      background: linear-gradient(to right, rgba(15,23,42,1), rgba(30,64,175,0.35));
    }

    thead th {
      white-space: normal;
      line-height: 1.15;
      word-break: keep-all;
    }

    .hour-cell {
      background: #020617;
      font-weight: 700;
      font-size: 12px;
      color: #E5E7EB;
      position: sticky;
      left: 0;
      z-index: 3;
      border-right: 1px solid rgba(31,41,55,0.95);
      box-shadow: 8px 0 18px rgba(0,0,0,0.35);
    }

    .slot-cell {
      transition: background-color 0.15s ease, box-shadow 0.15s ease, transform 0.1s ease, color 0.15s ease;
      cursor: default;
      height: 70px;
      vertical-align: middle;
    }

    .slot-label {
      display: flex;
      flex-direction: column;
      gap: 2px;
      align-items: center;
      justify-content: center;
      line-height: 1.2;
      height: 100%;
    }

    .slot-free {
      background-color: #022c22;
      color: #ECFDF5;
      cursor: pointer;
    }

    .slot-free:hover {
      background-color: #065f46;
      box-shadow: 0 0 0 1px rgba(16,185,129,0.5);
      transform: translateY(-1px);
    }

    .slot-booked {
      background-color: rgba(127, 29, 29, 0.55);
      color: #FEE2E2;
      cursor: not-allowed;
    }

    .legend-dot.booked { background-color: rgba(127, 29, 29, 0.55); }

    .slot-selected {
      background: linear-gradient(135deg, #1d4ed8, #4c1d95);
      color: #F9FAFB;
      cursor: default;
      box-shadow: 0 0 0 1px rgba(129,140,248,0.7);
    }

    .slot-price-main { font-weight: 700; font-size: 14px; }
    .slot-price-total { font-size: 11px; color: var(--sb-text-muted); }

    .slot-status {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      opacity: 0.9;
    }

    .resa-legend {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem 1.5rem;
      align-items: center;
      margin-top: 0.85rem;
      font-size: 11px;
      color: var(--sb-text-muted);
    }

    .legend-item { display: inline-flex; align-items: center; gap: 6px; }

    .legend-dot {
      width: 14px;
      height: 14px;
      border-radius: 4px;
      border: 1px solid rgba(15,23,42,0.9);
    }

    .legend-dot.free { background-color: #022c22; }
    .legend-dot.selected { background: linear-gradient(135deg, #1d4ed8, #4c1d95); }

    .resa-pricing-rules {
      margin-top: 0.4rem;
      font-size: 11px;
      color: var(--sb-text-muted);
    }

    #message {
      margin-top: 1rem;
      font-size: 12px;
      color: #F9FAFB;
      white-space: pre-line;
      min-height: 1em;
    }

    #slot-modal[hidden] { display: none; }

    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(15,23,42,0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 60;
      backdrop-filter: blur(4px);
      padding: 18px;
    }

    .modal-dialog {
      background: #020617;
      border-radius: 22px;
      padding: 1.85rem 1.85rem 1.6rem;
      max-width: 520px;
      width: 100%;
      box-shadow: 0 24px 70px rgba(0,0,0,0.95);
      border: 1px solid rgba(248,250,251,0.12);
    }

    .modal-dialog h2 {
      font-size: 20px;
      margin-bottom: 10px;
      letter-spacing: 0.02em;
    }

    .modal-dialog p {
      font-size: 13.5px;
      color: rgba(229,231,235,0.92);
      line-height: 1.7;
      margin: 0 0 12px;
    }

    #modal-slot-info {
      color: rgba(249,250,251,0.95);
      font-weight: 600;
      margin-bottom: 14px;
    }

    .modal-extra-text {
      font-size: 13px;
      color: rgba(156,163,175,0.95);
      line-height: 1.75;
      margin: 0 0 12px;
    }

    .modal-divider {
      height: 1px;
      background: rgba(148,163,184,0.18);
      margin: 14px 0 14px;
      border-radius: 999px;
    }

    .modal-persons-row {
      display: flex;
      flex-direction: column;
      align-items: stretch;
      gap: 8px;
      margin: 10px 0 16px;
    }

    .modal-persons-row label {
      font-size: 13px;
      color: #E5E7EB;
      font-weight: 600;
    }

    #modal-persons-select {
      padding: 10px 14px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.6);
      background: #020617;
      color: #F9FAFB;
      font-size: 14px;
      outline: none;
      width: 100%;
    }

    .modal-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: flex-end;
      margin-top: 4px;
    }

    .modal-actions button {
      border-radius: 999px;
      border: none;
      padding: 0.85rem 1.2rem;
      font-size: 14px;
      cursor: pointer;
      white-space: nowrap;
      min-height: 44px;
    }

    #modal-cart {
      background: linear-gradient(90deg, var(--sb-red), var(--sb-orange));
      color: #F9FAFB;
      box-shadow:
        0 0 0 1px rgba(248,250,251,0.12),
        0 16px 40px rgba(0,0,0,0.9);
    }

    #modal-continue {
      background: transparent;
      color: #E5E7EB;
      border: 1px solid rgba(148,163,184,0.6);
    }

    @media (max-width: 520px) {
      .modal-dialog {
        padding: 1.55rem 1.35rem 1.25rem;
        max-width: 100%;
        border-radius: 20px;
      }
      .modal-actions { flex-direction: column; }
      .modal-actions button { width: 100%; }
    }

    /* =======================
       VUE MOBILE : cr√©neaux en cartes (plus lisible)
       ======================= */

    .mobile-slots {
      display: none;
      margin-top: 14px;
      gap: 12px;
    }

    .mobile-box-card {
      border: 1px solid rgba(148, 163, 184, 0.28);
      border-radius: 16px;
      background: rgba(2, 6, 23, 0.65);
      box-shadow: 0 16px 40px rgba(0,0,0,0.55);
      overflow: hidden;
    }

    .mobile-box-head {
      padding: 12px 14px;
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 10px;
      background: linear-gradient(90deg, rgba(15,23,42,1), rgba(30,64,175,0.25));
      border-bottom: 1px solid rgba(148, 163, 184, 0.18);
    }

    .mobile-box-title {
      font-family: "League Spartan", system-ui, sans-serif;
      font-size: 16px;
      letter-spacing: 0.06em;
      text-transform: uppercase;
    }

    .mobile-box-meta {
      font-size: 12px;
      color: rgba(156,163,175,0.95);
      white-space: nowrap;
    }

    /* ‚úÖ CENTRAGE + rendu plus clean sur mobile */
    .mobile-slot-grid {
      padding: 14px 12px 16px;
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      justify-content: center;   /* ‚úÖ centre les pills */
      align-items: stretch;
    }

    .mobile-slot-pill {
      border: 1px solid rgba(16,185,129,0.35);
      background: rgba(2, 44, 34, 0.75);
      color: #ECFDF5;
      border-radius: 999px;
      padding: 12px 14px;
      min-width: 180px;          /* ‚úÖ plus homog√®ne */
      max-width: 240px;
      cursor: pointer;
      user-select: none;
      transition: transform 0.12s ease, box-shadow 0.12s ease, filter 0.12s ease;

      display: flex;             /* ‚úÖ centre le texte */
      flex-direction: column;
      align-items: center;
      text-align: center;
    }

    .mobile-slot-pill:active { transform: scale(0.98); }

    .mobile-slot-pill:hover {
      box-shadow: 0 0 0 1px rgba(16,185,129,0.35);
      filter: brightness(1.05);
    }

    .mobile-slot-time {
      font-weight: 800;
      font-size: 14px;
      letter-spacing: 0.02em;
      line-height: 1.15;
    }

    .mobile-slot-price {
      margin-top: 6px;
      font-size: 13px;
      color: rgba(236,253,245,0.92);
      line-height: 1.15;
    }

    .mobile-slot-sub {
      margin-top: 4px;
      font-size: 12px;
      color: rgba(156,163,175,0.95);
      line-height: 1.15;
    }

    .mobile-slot-pill.selected {
      border-color: rgba(129,140,248,0.65);
      background: linear-gradient(135deg, #1d4ed8, #4c1d95);
      color: #F9FAFB;
    }

    .mobile-empty {
      padding: 12px 14px 16px;
      color: rgba(156,163,175,0.95);
      font-size: 13px;
      line-height: 1.55;
    }

    @media (max-width: 768px) {
      .table-wrapper { display: none; }
      .table-scroll-hint { display: none !important; }
      .mobile-slots { display: flex; flex-direction: column; }
    }

    footer {
      background:#020617;
      color:#e5e7eb;
      padding:32px 24px 18px;
      border-top: 1px solid #111827;
    }

    .newsletter-container {
      max-width:var(--sb-container-width);
      margin:0 auto 24px;
      text-align:center;
    }
    .newsletter-container h3 { margin-bottom:6px; }
    .newsletter-container p {
      margin-top: 0;
      font-size: 13px;
      color: var(--sb-text-muted);
    }

    .newsletter-row {
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      justify-content:center;
      margin-top: 8px;
    }

    footer input[type=email] {
      padding:10px 12px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,0.4);
      min-width:240px;
      max-width:360px;
      font-size:14px;
      background:#020617;
      color:#F9FAFB;
      outline: none;
    }

    footer input[type=email]::placeholder { color: rgba(156,163,175,0.9); }

    footer button {
      padding:10px 18px;
      border:none;
      border-radius:999px;
      background:linear-gradient(90deg,var(--sb-red),var(--sb-orange));
      color:#F9FAFB;
      font-weight:600;
      font-size:14px;
      cursor:pointer;
      box-shadow:
        0 0 0 1px rgba(248,250,251,0.12),
        0 16px 40px rgba(0,0,0,0.9);
    }

    .footer-columns {
      max-width:var(--sb-container-width);
      margin:0 auto;
      display:flex;
      flex-wrap:wrap;
      gap:24px;
      justify-content:space-between;
      font-size:13px;
    }

    .footer-brand { display:flex; align-items:center; gap:10px; }
    .footer-brand img { height:80px; width:auto; display:block; }
    .footer-columns p { margin:4px 0; }

    .footer-social .social-link {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 13px;
      margin: 4px 0;
      color: inherit;
      text-decoration: none;
    }

    .footer-social .social-link:hover { color: #f97316; }

    .footer-social .social-icon {
      width: 24px;
      height: 24px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }

    .footer-bottom {
      max-width:var(--sb-container-width);
      margin:20px auto 0;
      padding-top:8px;
      font-size:11px;
      text-align:center;
      color:#9CA3AF;
      border-top:1px solid #111827;
    }

    @media (max-width: 600px) {
      .hero-resa { padding-top: 9rem; }
      .hero-resa h1 { font-size: 26px; }
    }
  </style>
</head>

<body>

  <!-- HEADER -->
  <header class="site-header">
    <div class="header-inner">
      <a href="index.html" class="brand">
        <img src="logo.png" alt="Logo Singbox, karaok√© box √† Toulouse" class="brand-logo" />
        <span class="brand-text">Singbox</span>
      </a>

      <nav class="main-nav" aria-label="Navigation principale">
        <ul>
          <li><a href="index.html">Accueil</a></li>
          <li><a href="concept.html">Le concept</a></li>
          <li><a href="box.html">Les box</a></li>
          <li><a href="actualites.html">Actualit√©s</a></li>
          <li><a href="contact.html">Contact</a></li>
          <li><a href="mon-compte.html">Mon compte</a></li>
        </ul>
      </nav>

      <div class="header-actions">
        <a href="reservation.html" class="nav-cta">R√©server</a>
        <a href="panier.html" class="cart-icon" aria-label="Acc√©der au panier">
          üõí<span id="cart-count"></span>
        </a>
        <button class="burger-button" id="burger-button" aria-label="Ouvrir le menu">‚ò∞</button>
      </div>
    </div>
  </header>

  <!-- MENU MOBILE -->
  <nav class="mobile-nav" id="mobile-nav" aria-label="Menu mobile">
    <ul>
      <li><a href="index.html">Accueil</a></li>
      <li><a href="concept.html">Le concept</a></li>
      <li><a href="box.html">Les box</a></li>
      <li><a href="actualites.html">Actualit√©s</a></li>
      <li><a href="contact.html">Contact</a></li>
      <li><a href="mon-compte.html">Mon compte</a></li>
    </ul>
  </nav>

  <!-- HERO -->
  <section class="hero-resa">
    <div class="hero-inner">
      <p class="hero-eyebrow">R√âSERVATION KARAOK√â BOX</p>
      <h1>R√©server votre karaok√© box √† Toulouse</h1>
      <p>
        Choisissez votre date, votre box (Nuit √©toil√©e ou Ambiance Sunset) et cliquez sur une session de 1h30 libre
        pour l‚Äôajouter √† votre panier. R√©servation 100&nbsp;% en ligne, 24h/24.
      </p>
    </div>
  </section>

  <main>
    <div class="container resa-wrapper">
      <section class="resa-card" aria-label="Planning de r√©servation des box Singbox">
        <h2>Choisissez votre date et votre session de 1h30</h2>

        <div class="resa-header">
          <div class="resa-field resa-field-date">
            <label for="date-input" class="resa-label-inline">
              <span>Date de votre s√©ance</span>
              <span id="persons-indicator" class="resa-indicator">‚Äì 2 personnes (facturation min. 2)</span>
            </label>
            <input type="date" id="date-input" />
          </div>

          <div class="resa-field resa-field-persons">
            <label for="persons-select">Nombre de personnes</label>
            <select id="persons-select" class="resa-persons-select">
              <option value="1">1 personne</option>
              <option value="2" selected>2 personnes</option>
              <option value="3">3 personnes</option>
              <option value="4">4 personnes</option>
              <option value="5">5 personnes</option>
              <option value="6">6 personnes</option>
              <option value="7">7 personnes</option>
              <option value="8">8 personnes</option>
            </select>
          </div>

          <div class="resa-field resa-button-wrapper">
            <button id="load-button" type="button">Voir les cr√©neaux disponibles</button>
          </div>
        </div>

        <p class="resa-note">
          Tarifs par personne, facturation minimale 2 personnes (m√™me si vous venez seul¬∑e). Capacit√©
          maximale : 8 personnes par box. Sessions de 1h30.
          Heures creuses seulement en semaine hors vacances scolaires.
        </p>

        <div class="resa-legend" aria-label="L√©gende des statuts">
          <div class="legend-item"><span class="legend-dot free"></span> <span>Libre</span></div>
          <div class="legend-item"><span class="legend-dot booked"></span> <span>R√©serv√©</span></div>
          <div class="legend-item"><span class="legend-dot selected"></span> <span>Dans ton panier</span></div>
        </div>

        <p class="table-scroll-hint">
          Sur mobile, glissez le tableau vers la droite pour voir l‚Äôautre box
          <span class="arrow">‚ü∂</span>
        </p>

        <div class="table-wrapper">
          <table id="planning-table" aria-label="Tableau des cr√©neaux de r√©servation pour les box Singbox">
            <!-- Table g√©n√©r√©e en JS -->
          </table>
        </div>

        <!-- ‚úÖ Vue mobile (plus lisible) -->
        <div id="mobile-slots" class="mobile-slots" aria-label="Cr√©neaux disponibles (vue mobile)"></div>

        <p class="resa-pricing-rules">
          7,90&nbsp;‚Ç¨ par personne en heures creuses (4h‚Äì14h) du lundi au vendredi hors vacances scolaires ‚Äì
          9,90&nbsp;‚Ç¨ par personne le reste du temps (week-end et vacances scolaires compris).
          Facturation minimale 2 personnes par session de 1h30 (si vous venez seul¬∑e, vous payez pour 2 personnes).
        </p>

        <p id="message"></p>
      </section>
    </div>
  </main>

  <!-- MODAL CONFIRMATION CR√âNEAU -->
  <div id="slot-modal" class="modal-backdrop" hidden>
    <div class="modal-dialog" role="dialog" aria-modal="true" aria-labelledby="modal-slot-info">
      <h2>Session ajout√©e au panier</h2>
      <p id="modal-slot-info"></p>

      <p class="modal-extra-text">
        Le nombre de personnes est actuellement r√©gl√© sur
        <strong><span id="modal-persons-current"></span></strong> (facturation minimale 2 personnes).
      </p>
      <p class="modal-extra-text">
        Si tu viens seul(e), tu peux mettre 1 personne (tu payeras automatiquement pour 2).
        Les box peuvent accueillir jusqu‚Äô√† 8 personnes.
      </p>

      <div class="modal-divider"></div>

      <div class="modal-persons-row">
        <label for="modal-persons-select">Modifier le nombre de personnes</label>
        <select id="modal-persons-select">
          <option value="1">1 personne</option>
          <option value="2">2 personnes</option>
          <option value="3">3 personnes</option>
          <option value="4">4 personnes</option>
          <option value="5">5 personnes</option>
          <option value="6">6 personnes</option>
          <option value="7">7 personnes</option>
          <option value="8">8 personnes</option>
        </select>
      </div>

      <div class="modal-actions">
        <button id="modal-continue" type="button">Continuer ma r√©servation</button>
        <button id="modal-cart" type="button">Valider mon panier</button>
      </div>
    </div>
  </div>

  <!-- FOOTER -->
  <footer>
    <div class="newsletter-container">
      <h3>Inscrivez-vous √† notre newsletter</h3>
      <p>Des playlists, des infos exclusives, des photos d‚Äôambiance‚Ä¶ Tout arrive bient√¥t.</p>
      <div class="newsletter-row">
        <input id="newsletter-email" type="email" placeholder="Entrez votre adresse e-mail" required />
        <button id="newsletter-submit" type="button">S'abonner aux actualit√©s</button>
      </div>
      <p id="newsletter-message" style="font-size:12px;margin-top:6px;min-height:16px;"></p>
    </div>

    <div class="footer-columns">
      <div class="footer-brand">
        <img src="logo.png" alt="Logo Singbox, karaok√© box √† Toulouse" />
        <div>
          <p style="font-weight:700;font-size:16px;margin-bottom:4px;">Singbox</p>
          <p style="margin:0;">Karaok√© Box √† Toulouse</p>
        </div>
      </div>

      <div>
        <p><strong>Infos</strong></p>
        <p><a href="mentions-legales.html">Mentions l√©gales</a></p>
        <p><a href="politique-confidentialite.html">Politique de confidentialit√©</a></p>
        <p><a href="cgv.html">CGV</a></p>
      </div>

      <div>
        <p><strong>Contact</strong></p>
        <p>Adresse : 66 Rue de la R√©publique, 31300 Toulouse</p>
        <p>Email : contactsingbox@gmail.com</p>
        <p>T√©l√©phone : 06 00 00 00 00</p>
      </div>

      <div class="footer-social">
        <p><strong>R√©seaux</strong></p>

        <a href="https://www.instagram.com/singboxtoulouse/" target="_blank" rel="noopener noreferrer" class="social-link">
          <span class="social-icon">
            <svg viewBox="0 0 24 24" aria-hidden="true">
              <rect x="3" y="3" width="18" height="18" rx="5" ry="5" fill="none" stroke="currentColor" stroke-width="1.8"></rect>
              <circle cx="12" cy="12" r="4.2" fill="none" stroke="currentColor" stroke-width="1.8"></circle>
              <circle cx="17" cy="7" r="1.2" fill="currentColor"></circle>
            </svg>
          </span>
          <span>Instagram</span>
        </a>

        <a href="https://www.tiktok.com/@singbox.toulouse/" target="_blank" rel="noopener noreferrer" class="social-link">
          <span class="social-icon">
            <svg viewBox="0 0 24 24" aria-hidden="true">
              <path d="M15.5 5.1c.7.8 1.6 1.4 2.6 1.7v2.6c-1.1-.1-2.1-.4-3-0.9v5.3c0 2.8-2.3 5.1-5.2 5.1S4.8 16.6 4.8 13.8c0-2.6 1.9-4.8 4.5-5.1v2.7c-1 .3-1.7 1.2-1.7 2.3 0 1.3 1 2.3 2.3 2.3s2.3-1 2.3-2.3V4.5h3.3v.6z"></path>
            </svg>
          </span>
          <span>TikTok</span>
        </a>
      </div>
    </div>

    <div class="footer-bottom">R√©alis√© avec ‚ô• pour Singbox</div>
  </footer>

  <script>
    const API_BASE = "https://singbox-backend.onrender.com";
    const SLOT_DURATION_MIN = 90;
    const SLOT_STEP_MIN = 90;

    let refreshPlanningGlobal = null;

    function toLocalYMD(dateObj) {
      const y = dateObj.getFullYear();
      const m = String(dateObj.getMonth() + 1).padStart(2, "0");
      const d = String(dateObj.getDate()).padStart(2, "0");
      return `${y}-${m}-${d}`;
    }

    function pad2(n) { return String(n).padStart(2, "0"); }

    function minutesToTimeLabel(totalMin) {
      const h = Math.floor((totalMin / 60) % 24);
      const m = totalMin % 60;
      if (m === 0) return `${pad2(h)}h`;
      return `${pad2(h)}h${pad2(m)}`;
    }

    function parseTimeToMinutes(value) {
      if (value === null || value === undefined) return null;

      if (typeof value === "number" && !isNaN(value)) {
        if (value >= 0 && value <= 23) return value * 60;
        if (value >= 0 && value < 24 * 60) return value;
        return null;
      }

      if (typeof value !== "string") return null;
      const v = value.trim();

      let m = v.match(/^(\d{1,2}):(\d{2})$/);
      if (m) {
        const hh = parseInt(m[1], 10);
        const mm = parseInt(m[2], 10);
        if (hh >= 0 && hh <= 23 && mm >= 0 && mm <= 59) return hh * 60 + mm;
        return null;
      }

      m = v.match(/^(\d{1,2})h(\d{2})?$/i);
      if (m) {
        const hh = parseInt(m[1], 10);
        const mm = m[2] ? parseInt(m[2], 10) : 0;
        if (hh >= 0 && hh <= 23 && mm >= 0 && mm <= 59) return hh * 60 + mm;
        return null;
      }

      if (/^\d{1,2}$/.test(v)) {
        const hh = parseInt(v, 10);
        if (hh >= 0 && hh <= 23) return hh * 60;
      }

      return null;
    }

    function getItemStartMinutes(item) {
      if (!item) return null;
      if (typeof item.startMinutes === "number") return item.startMinutes;
      return parseTimeToMinutes(item.hour);
    }

    function getPanier() {
      try {
        return JSON.parse(localStorage.getItem("panier")) || [];
      } catch (e) {
        return [];
      }
    }

    function savePanier(panier) {
      localStorage.setItem("panier", JSON.stringify(panier));
    }

    function updateCartIcon() {
      const el = document.getElementById("cart-count");
      if (!el) return;
      const panier = getPanier();
      el.textContent = panier.length ? panier.length : "";
    }

    function formatSlotRange(startMinutes) {
      const startLabel = minutesToTimeLabel(startMinutes);
      const endTotal = startMinutes + SLOT_DURATION_MIN;
      const endLabel = minutesToTimeLabel(endTotal);
      return startLabel + "‚Äì" + endLabel;
    }

    function addSlotToCart(boxId, boxName, dateObj, startMinutes, price, persons) {
      const isoDate = toLocalYMD(dateObj);
      const panier = getPanier();

      const exists = panier.some(item =>
        item.type === "reservation" &&
        item.boxId === boxId &&
        item.date === isoDate &&
        getItemStartMinutes(item) === startMinutes
      );
      if (exists) return;

      const startLabel = minutesToTimeLabel(startMinutes);

      panier.push({
        type: "reservation",
        boxId,
        boxName,
        date: isoDate,
        hour: startLabel,
        startMinutes: startMinutes,
        price,
        persons
      });

      savePanier(panier);
      updateCartIcon();

      const msgEl = document.getElementById("message");
      const heureLabel = formatSlotRange(startMinutes);
      const prixAffiche = price.toFixed(2).replace(".", ",");

      if (msgEl) {
        msgEl.innerHTML = "<span>Session ajout√©e au panier : <strong>" +
          boxName +
          "</strong> ‚Äì " +
          heureLabel +
          " ‚Äì " +
          prixAffiche +
          "‚Ç¨ ‚Äì " +
          persons +
          " pers.</span>";
      }
    }

    let currentDateIsWeekend = false;
    let currentDateIsHoliday = false;

    async function checkDateContext(isoDate) {
      const parts = isoDate.split("-");
      const dateObj = new Date(
        parseInt(parts[0], 10),
        parseInt(parts[1], 10) - 1,
        parseInt(parts[2], 10)
      );

      const day = dateObj.getDay();
      currentDateIsWeekend = (day === 0 || day === 6);

      try {
        const res = await fetch(`${API_BASE}/api/is-vacances?date=${isoDate}`);
        if (!res.ok) {
          console.error("Erreur HTTP /api/is-vacances :", res.status);
          currentDateIsHoliday = false;
          return;
        }
        const data = await res.json();
        currentDateIsHoliday = !!(
          data.vacances ??
          data.is_vacances ??
          data.isHoliday ??
          data.holiday
        );
      } catch (e) {
        console.error("Erreur fetch vacances :", e);
        currentDateIsHoliday = false;
      }
    }

    function getSlotPrice(date, startMinutes, persons) {
      const nb = persons ? Math.max(persons, 2) : 2;
      const hour = Math.floor(startMinutes / 60);

      let baseRate;
      if (currentDateIsWeekend || currentDateIsHoliday) {
        baseRate = 9.90;
      } else {
        baseRate = (hour >= 4 && hour < 14) ? 7.90 : 9.90;
      }

      const total = baseRate * nb;
      return Number(total.toFixed(2));
    }

    let bookedIndex = {};
    let selectedPersons = 2;
    const BOXES = [
      { id: 1, name: "Nuit √©toil√©e" },
      { id: 2, name: "Ambiance Sunset" }
    ];
    let currentPlanningDateIso = null;

    let currentSlotChoice = null;
    let currentSlotCell = null;

    async function fetchReservationsForDate(isoDate) {
      bookedIndex = {};
      try {
        const res = await fetch(`${API_BASE}/api/slots?date=${isoDate}`);
        if (!res.ok) {
          console.error("Erreur HTTP /api/slots :", res.status);
          return;
        }
        const json = await res.json();
        const reservations = json.reservations || [];

        reservations.forEach(r => {
          const start = new Date(r.start_time);
          const h = start.getHours();
          const m = start.getMinutes();
          const startMinutes = h * 60 + m;

          const boxId = r.box_id;
          const key = `${boxId}-${startMinutes}`;
          bookedIndex[key] = true;
        });
      } catch (e) {
        console.error("Erreur fetchReservationsForDate :", e);
      }
    }

    function isSlotBooked(boxId, startMinutes) {
      const key = `${boxId}-${startMinutes}`;
      return !!bookedIndex[key];
    }

    function markCellSelected(td) {
      td.classList.remove("slot-free");
      td.classList.add("slot-selected");
      const statusSpan = td.querySelector(".slot-status");
      if (statusSpan) statusSpan.textContent = "Dans ton panier";
      td.onclick = null;
    }

    function updateModalSummary() {
      if (!currentSlotChoice) return;
      const infoEl = document.getElementById("modal-slot-info");
      const personsCurrentEl = document.getElementById("modal-persons-current");

      const parts = currentSlotChoice.date.split("-");
      const dateStr = parts[2] + "/" + parts[1] + "/" + parts[0];
      const range = formatSlotRange(currentSlotChoice.startMinutes);

      if (infoEl) {
        infoEl.textContent =
          currentSlotChoice.boxName +
          " ‚Äì " +
          dateStr +
          " ‚Äì " +
          range +
          " ‚Äì " +
          currentSlotChoice.persons +
          " pers.";
      }
      if (personsCurrentEl) personsCurrentEl.textContent = currentSlotChoice.persons;
    }

    function openSlotModal(slot, tdOrNull) {
      currentSlotChoice = slot;
      currentSlotCell = tdOrNull || null;

      const modal = document.getElementById("slot-modal");
      const personsSelect = document.getElementById("modal-persons-select");
      if (personsSelect) personsSelect.value = String(slot.persons);

      updateModalSummary();
      if (modal) modal.removeAttribute("hidden");
    }

    function closeSlotModal() {
      const modal = document.getElementById("slot-modal");
      if (modal) modal.setAttribute("hidden", "true");
      currentSlotChoice = null;
      currentSlotCell = null;
    }

    function finalizeSlot(goToCart) {
      if (!currentSlotChoice) return;
      const s = currentSlotChoice;

      addSlotToCart(s.boxId, s.boxName, s.dateObj, s.startMinutes, s.price, s.persons);

      if (currentSlotCell) {
        markCellSelected(currentSlotCell);
      } else {
        if (typeof refreshPlanningGlobal === "function") refreshPlanningGlobal();
      }

      closeSlotModal();
      if (goToCart) window.location.href = "panier.html";
    }

    function buildStartMinutesList() {
      const list = [];
      for (let m = 0; m < 24 * 60; m += SLOT_STEP_MIN) list.push(m);
      return list;
    }

    function buildPlanningTable(date) {
      const table = document.getElementById("planning-table");
      if (!table) return;

      const isoDate = toLocalYMD(date);
      currentPlanningDateIso = isoDate;

      const panier = getPanier();
      const startMinutesList = buildStartMinutesList();
      table.innerHTML = "";

      // colgroup fixe (anti chevauchement header)
      const colgroup = document.createElement("colgroup");
      const colHour = document.createElement("col");
      colHour.style.width = "170px";
      colgroup.appendChild(colHour);

      BOXES.forEach(() => {
        const c = document.createElement("col");
        c.style.width = "235px";
        colgroup.appendChild(c);
      });

      table.appendChild(colgroup);

      const thead = document.createElement("thead");
      const headRow = document.createElement("tr");

      const hourTh = document.createElement("th");
      hourTh.textContent = "Heure (session 1h30)";
      hourTh.className = "hour-cell";
      headRow.appendChild(hourTh);

      BOXES.forEach(box => {
        const th = document.createElement("th");
        th.textContent = box.name;
        headRow.appendChild(th);
      });

      thead.appendChild(headRow);
      table.appendChild(thead);

      const tbody = document.createElement("tbody");

      const now = new Date();
      const isToday =
        date.getFullYear() === now.getFullYear() &&
        date.getMonth() === now.getMonth() &&
        date.getDate() === now.getDate();

      startMinutesList.forEach(startMinutes => {
        // ‚úÖ PC : si le cr√©neau est pass√© aujourd‚Äôhui, on n‚Äôaffiche PAS la ligne du tout
        if (isToday) {
          const nowMinutes = now.getHours() * 60 + now.getMinutes();
          const isPastToday = startMinutes <= nowMinutes;
          if (isPastToday) return;
        }

        const tr = document.createElement("tr");

        const hourTd = document.createElement("td");
        hourTd.className = "hour-cell";
        hourTd.textContent = formatSlotRange(startMinutes);
        tr.appendChild(hourTd);

        BOXES.forEach(box => {
          const td = document.createElement("td");
          td.classList.add("slot-cell");
          td.dataset.boxId = String(box.id);
          td.dataset.startMinutes = String(startMinutes);
          td.dataset.date = isoDate;

          const persons = selectedPersons || 2;
          const totalPrice = getSlotPrice(date, startMinutes, persons);

          const hour = Math.floor(startMinutes / 60);
          const perPersonRate =
            (currentDateIsWeekend || currentDateIsHoliday)
              ? 9.90
              : ((hour >= 4 && hour < 14) ? 7.90 : 9.90);

          const booked = isSlotBooked(box.id, startMinutes);

          const wrapper = document.createElement("div");
          wrapper.className = "slot-label";

          if (booked) {
            td.classList.add("slot-booked");
            const statusSpan = document.createElement("span");
            statusSpan.className = "slot-status";
            statusSpan.textContent = "R√©serv√©";
            wrapper.appendChild(statusSpan);
          } else {
            const alreadyInCart = panier.some(item =>
              item.type === "reservation" &&
              item.boxId === box.id &&
              item.date === isoDate &&
              getItemStartMinutes(item) === startMinutes
            );

            const perPersonStr = perPersonRate.toFixed(2).replace(".", ",");
            const totalStr = totalPrice.toFixed(2).replace(".", ",");

            const mainPriceSpan = document.createElement("span");
            mainPriceSpan.className = "slot-price-main";
            mainPriceSpan.textContent = perPersonStr + "‚Ç¨/pers";

            const totalPriceSpan = document.createElement("span");
            totalPriceSpan.className = "slot-price-total";
            totalPriceSpan.textContent = "soit " + totalStr + "‚Ç¨ / session";

            wrapper.appendChild(mainPriceSpan);
            wrapper.appendChild(totalPriceSpan);

            const statusSpan = document.createElement("span");
            statusSpan.className = "slot-status";
            statusSpan.textContent = alreadyInCart ? "Dans ton panier" : "Libre";
            wrapper.appendChild(statusSpan);

            if (alreadyInCart) {
              td.classList.add("slot-selected");
            } else {
              td.classList.add("slot-free");
              td.onclick = function () {
                const personsForSlot = selectedPersons || 1;
                const priceForSlot = getSlotPrice(date, startMinutes, personsForSlot);

                const slotInfo = {
                  boxId: box.id,
                  boxName: box.name,
                  date: isoDate,
                  dateObj: date,
                  startMinutes,
                  price: priceForSlot,
                  persons: personsForSlot
                };

                openSlotModal(slotInfo, td);
              };
            }
          }

          td.appendChild(wrapper);
          tr.appendChild(td);
        });

        tbody.appendChild(tr);
      });

      table.appendChild(tbody);
    }

    // Vue mobile "cartes" : uniquement les cr√©neaux dispo (et ceux d√©j√† au panier)
    function buildMobileSlots(date) {
      const container = document.getElementById("mobile-slots");
      if (!container) return;

      const isoDate = toLocalYMD(date);
      const panier = getPanier();
      const startMinutesList = buildStartMinutesList();

      const now = new Date();
      const isToday =
        date.getFullYear() === now.getFullYear() &&
        date.getMonth() === now.getMonth() &&
        date.getDate() === now.getDate();

      container.innerHTML = "";

      BOXES.forEach(box => {
        const card = document.createElement("div");
        card.className = "mobile-box-card";

        const head = document.createElement("div");
        head.className = "mobile-box-head";

        const title = document.createElement("div");
        title.className = "mobile-box-title";
        title.textContent = box.name;

        const meta = document.createElement("div");
        meta.className = "mobile-box-meta";
        meta.textContent = "Sessions 1h30";

        head.appendChild(title);
        head.appendChild(meta);
        card.appendChild(head);

        const grid = document.createElement("div");
        grid.className = "mobile-slot-grid";

        let countShown = 0;

        startMinutesList.forEach(startMinutes => {
          const booked = isSlotBooked(box.id, startMinutes);

          let isPastToday = false;
          if (isToday) {
            const nowMinutes = now.getHours() * 60 + now.getMinutes();
            isPastToday = startMinutes <= nowMinutes;
          }

          const alreadyInCart = panier.some(item =>
            item.type === "reservation" &&
            item.boxId === box.id &&
            item.date === isoDate &&
            getItemStartMinutes(item) === startMinutes
          );

          if (booked || isPastToday) return;
          countShown++;

          const personsForSlot = selectedPersons || 1;
          const priceForSlot = getSlotPrice(date, startMinutes, personsForSlot);

          const hour = Math.floor(startMinutes / 60);
          const perPersonRate =
            (currentDateIsWeekend || currentDateIsHoliday)
              ? 9.90
              : ((hour >= 4 && hour < 14) ? 7.90 : 9.90);

          const pill = document.createElement("div");
          pill.className = "mobile-slot-pill" + (alreadyInCart ? " selected" : "");

          const t = document.createElement("div");
          t.className = "mobile-slot-time";
          t.textContent = formatSlotRange(startMinutes);

          const p = document.createElement("div");
          p.className = "mobile-slot-price";
          p.textContent = perPersonRate.toFixed(2).replace(".", ",") + "‚Ç¨/pers";

          const s = document.createElement("div");
          s.className = "mobile-slot-sub";
          s.textContent = "Soit " + priceForSlot.toFixed(2).replace(".", ",") + "‚Ç¨ / session";

          pill.appendChild(t);
          pill.appendChild(p);
          pill.appendChild(s);

          if (!alreadyInCart) {
            pill.addEventListener("click", () => {
              const slotInfo = {
                boxId: box.id,
                boxName: box.name,
                date: isoDate,
                dateObj: date,
                startMinutes,
                price: priceForSlot,
                persons: personsForSlot
              };
              openSlotModal(slotInfo, null);
            });
          }

          grid.appendChild(pill);
        });

        if (countShown === 0) {
          const empty = document.createElement("div");
          empty.className = "mobile-empty";
          empty.textContent = "Aucun cr√©neau disponible pour cette box √† cette date.";
          card.appendChild(empty);
        } else {
          card.appendChild(grid);
        }

        container.appendChild(card);
      });
    }

    document.addEventListener("DOMContentLoaded", function () {
      const burgerBtn = document.getElementById("burger-button");
      const mobileNav = document.getElementById("mobile-nav");
      if (burgerBtn && mobileNav) {
        burgerBtn.addEventListener("click", () => mobileNav.classList.toggle("open"));
        mobileNav.addEventListener("click", (e) => {
          if (e.target.tagName === "A") mobileNav.classList.remove("open");
        });
      }

      updateCartIcon();

      const dateInput = document.getElementById("date-input");
      const loadButton = document.getElementById("load-button");
      const personsSelect = document.getElementById("persons-select");
      const personsIndicator = document.getElementById("persons-indicator");

      const today = new Date();
      const isoToday = toLocalYMD(today);

      const params = new URLSearchParams(window.location.search);
      const urlDate = params.get("date");
      const urlPeople = params.get("people");

      if (dateInput) {
        dateInput.min = isoToday;
        if (urlDate && urlDate >= isoToday) dateInput.value = urlDate;
        else dateInput.value = isoToday;
      }

      if (personsSelect) {
        let initialPersons = 2;
        if (urlPeople) {
          const n = parseInt(urlPeople, 10);
          if (!isNaN(n) && n >= 1 && n <= 8) initialPersons = n;
        }
        selectedPersons = initialPersons;
        personsSelect.value = String(initialPersons);
        if (personsIndicator) {
          personsIndicator.textContent =
            "‚Äì " + initialPersons + " personne" + (initialPersons > 1 ? "s" : "") +
            " (facturation min. 2)";
        }

        personsSelect.addEventListener("change", () => {
          let n = parseInt(personsSelect.value, 10);
          if (isNaN(n) || n < 1) n = 1;
          if (n > 8) n = 8;
          selectedPersons = n;

          if (personsIndicator) {
            personsIndicator.textContent =
              "‚Äì " + n + " personne" + (n > 1 ? "s" : "") + " (facturation min. 2)";
          }

          refreshPlanning();
        });
      }

      async function refreshPlanning() {
        if (!dateInput || !dateInput.value) return;

        const iso = dateInput.value;
        const todayYMD = toLocalYMD(new Date());
        if (iso < todayYMD) {
          const msg = document.getElementById("message");
          if (msg) msg.textContent = "Tu ne peux pas r√©server √† une date pass√©e üôÇ";
          return;
        }

        const parts = iso.split("-");
        const theDate = new Date(
          parseInt(parts[0], 10),
          parseInt(parts[1], 10) - 1,
          parseInt(parts[2], 10)
        );

        await checkDateContext(iso);
        await fetchReservationsForDate(iso);

        buildPlanningTable(theDate);
        buildMobileSlots(theDate);

        const msgEl = document.getElementById("message");
        if (msgEl) msgEl.textContent = "";
      }

      refreshPlanningGlobal = refreshPlanning;

      if (loadButton) {
        loadButton.addEventListener("click", () => refreshPlanning());
      }

      refreshPlanning();

      const continueBtn = document.getElementById("modal-continue");
      const cartBtn = document.getElementById("modal-cart");
      const modalPersonsSelect = document.getElementById("modal-persons-select");

      if (modalPersonsSelect) {
        modalPersonsSelect.addEventListener("change", () => {
          if (!currentSlotChoice) return;
          let n = parseInt(modalPersonsSelect.value, 10);
          if (isNaN(n) || n < 1) n = 1;
          if (n > 8) n = 8;
          currentSlotChoice.persons = n;
          currentSlotChoice.price = getSlotPrice(currentSlotChoice.dateObj, currentSlotChoice.startMinutes, n);
          updateModalSummary();
        });
      }

      if (continueBtn) continueBtn.addEventListener("click", () => finalizeSlot(false));
      if (cartBtn) cartBtn.addEventListener("click", () => finalizeSlot(true));

      const modal = document.getElementById("slot-modal");
      if (modal) {
        modal.addEventListener("click", (e) => {
          if (e.target === modal) closeSlotModal();
        });
      }
    });
  </script>

  <!-- Supabase Newsletter Script -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const supabaseUrl = "https://sfckofydfqbllkxhxwnt.supabase.co";
      const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNmY2tvZnlkZnFibGxreGh4d250Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQxOTA4ODQsImV4cCI6MjA3OTc2Njg4NH0.2kg7GxQBU8nArCCbJPm0JSn208izXCeiDX266FUC1lw";
      const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);

      const emailInput = document.getElementById("newsletter-email");
      const submitBtn = document.getElementById("newsletter-submit");
      const messageBox = document.getElementById("newsletter-message");

      if (!emailInput || !submitBtn || !messageBox) return;

      submitBtn.addEventListener("click", async () => {
        const email = emailInput.value.trim();

        messageBox.style.color = "#e5e7eb";
        messageBox.textContent = "Envoi en cours...";

        if (!email || !email.includes("@")) {
          messageBox.style.color = "#ff6b6b";
          messageBox.textContent = "Veuillez entrer une adresse e-mail valide.";
          return;
        }

        const { error } = await supabaseClient
          .from("newsletter_subscriptions")
          .insert({ email });

        if (error) {
          if (error.code === "23505" || (error.message && error.message.includes("duplicate key value"))) {
            messageBox.style.color = "#38bdf8";
            messageBox.textContent = "Vous √™tes d√©j√† inscrit √† la newsletter üòâ";
          } else {
            messageBox.style.color = "#ff6b6b";
            messageBox.textContent = "Erreur : " + error.message;
          }
        } else {
          messageBox.style.color = "#38bdf8";
          messageBox.textContent = "Merci ! Vous √™tes inscrit üéâ";
          emailInput.value = "";
        }
      });
    });
  </script>

</body>
</html>
