<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="UTF-8" />
  <title>R√©server votre karaok√© box √† Toulouse | Singbox</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- SEO -->
  <meta name="description" content="R√©servez facilement votre karaok√© box privative √† Toulouse chez Singbox. Choisissez votre date, votre box (Nuit √©toil√©e ou Ambiance Sunset) et un cr√©neau libre, avec tarifs dynamiques selon le jour et l‚Äôhoraire." />
  <meta name="robots" content="index,follow" />
  <meta name="keywords" content="karaoke toulouse, karaok√© toulouse, karaoke box toulouse, karaok√© privatif toulouse, r√©server karaok√© toulouse, singbox, nuit √©toil√©e, ambiance sunset" />
  <link rel="canonical" href="https://www.singbox.fr/reservation" />

  <!-- Open Graph / Facebook -->
  <meta property="og:title" content="R√©server votre karaok√© box √† Toulouse | Singbox" />
  <meta property="og:description" content="R√©servez votre box de karaok√© privative √† Toulouse (Nuit √©toil√©e ou Ambiance Sunset). Cr√©neaux dynamiques, tarifs selon l‚Äôhoraire et ajout imm√©diat au panier." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://www.singbox.fr/reservation" />
  <meta property="og:site_name" content="Singbox" />
  <meta property="og:image" content="https://www.singbox.fr/images/singbox-social.jpg" />

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="R√©server votre karaok√© box √† Toulouse | Singbox" />
  <meta name="twitter:description" content="R√©servez votre karaok√© box privative √† Toulouse en quelques clics chez Singbox : deux ambiances, tarifs dynamiques et r√©servation 100% en ligne." />
  <meta name="twitter:image" content="https://www.singbox.fr/images/singbox-social.jpg" />

  <!-- Donn√©es structur√©es LocalBusiness -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "EntertainmentBusiness",
    "name": "Singbox",
    "image": "https://www.singbox.fr/logo.png",
    "@id": "https://www.singbox.fr/",
    "url": "https://www.singbox.fr/",
    "telephone": "+33 6 00 00 00 00",
    "address": {
      "@type": "PostalAddress",
      "streetAddress": "66 Rue de la R√©publique",
      "postalCode": "31300",
      "addressLocality": "Toulouse",
      "addressCountry": "FR"
    },
    "priceRange": "‚Ç¨‚Ç¨",
    "description": "Karaok√© box privatif √† Toulouse : r√©servez des salons enti√®rement insonoris√©s pour chanter entre amis, en famille ou entre coll√®gues.",
    "sameAs": [
      "https://www.instagram.com/singboxtoulouse/",
      "https://www.tiktok.com/@singbox.toulouse/"
    ]
  }
  </script>

  <!-- Donn√©es structur√©es WebPage -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebPage",
    "name": "R√©server votre karaok√© box √† Toulouse | Singbox",
    "url": "https://www.singbox.fr/reservation",
    "description": "R√©servez votre karaok√© box privative √† Toulouse chez Singbox. Choisissez votre date, votre box (Nuit √©toil√©e ou Ambiance Sunset) et un cr√©neau libre, avec tarifs dynamiques selon le jour et l‚Äôhoraire.",
    "inLanguage": "fr-FR",
    "isPartOf": {
      "@type": "WebSite",
      "name": "Singbox",
      "url": "https://www.singbox.fr"
    }
  }
  </script>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=League+Spartan:wght@600;700;800&family=Montserrat:wght@300;400;500;600&display=swap"
    rel="stylesheet"
  >

  <style>
    :root {
      --sb-bg-main: #050814;
      --sb-bg-deep: #020617;
      --sb-card: #050b18;
      --sb-text-main: #F9FAFB;
      --sb-text-muted: #9CA3AF;
      --sb-red: #C94C35;
      --sb-orange: #F97316;
      --sb-border-soft: rgba(148, 163, 184, 0.35);
      --sb-container-width: 1180px;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: "Montserrat", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: var(--sb-text-main);
      background:
        radial-gradient(circle at 10% 0%, rgba(107,18,32,0.65), transparent 55%),
        radial-gradient(circle at 80% 10%, rgba(30,64,175,0.7), transparent 60%),
        linear-gradient(145deg, #020617 0, #020617 40%, var(--sb-bg-main) 100%);
      min-height: 100vh;
    }

    a { text-decoration: none; color: inherit; }

    h1, h2, h3 {
      font-family: "League Spartan", system-ui, sans-serif;
      letter-spacing: 0.03em;
      margin: 0;
    }

    .container {
      max-width: var(--sb-container-width);
      margin: 0 auto;
      padding: 0 1.5rem;
    }

    /* ======================= HEADER GLOBAL ======================= */

    .site-header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 50;
      background: #020617;
      color: #fff;
      box-shadow: 0 14px 30px rgba(0,0,0,0.75);
      height: auto;
    }

    .header-inner {
      max-width: var(--sb-container-width);
      margin: 0 auto;
      padding: 12px 24px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 2rem;
      height: auto;
      flex-wrap: nowrap;
    }

    /* Bloc marque */
    .brand {
      display: flex;
      align-items: center;
      gap: 12px;
      text-decoration: none;
      flex-shrink: 0;
    }

    .brand-logo {
      width: 110px;
      height: auto;
      border-radius: 999px;
      display: block;
      object-fit: contain;
      filter:
        drop-shadow(0 0 12px rgba(255,255,255,0.16))
        drop-shadow(0 0 20px rgba(201,76,53,0.6));
    }

    .brand-text {
      font-family: "League Spartan", system-ui, sans-serif;
      font-weight: 600;
      letter-spacing: 0.15em;
      font-size: 26px;
      color: #F9FAFB;
      text-transform: uppercase;
      white-space: nowrap;
      display: flex;
      align-items: center;
    }

    /* NAV centrale */
    nav.main-nav {
      flex: 1;
      display: flex;
      justify-content: center;
      min-width: 0;
    }

    .main-nav ul {
      list-style: none;
      display: flex;
      gap: 32px;
      margin: 0;
      padding: 0;
      font-size: 14px;
    }

    .main-nav a {
      font-weight: 600;
      letter-spacing: 0.3px;
      color: #ffffff;
      text-decoration: none;
      position: relative;
      padding-bottom: 4px;
      white-space: nowrap;
    }

    .main-nav a::after {
      content: "";
      position: absolute;
      left: 0;
      bottom: 0;
      height: 2px;
      width: 0;
      background: linear-gradient(90deg, #ff6930, #ffb96f);
      border-radius: 6px;
      transition: width 0.3s ease;
    }

    .main-nav a:hover::after {
      width: 100%;
    }

    .main-nav a:hover {
      color: #ffb96f;
      transition: 0.25s ease;
    }

    .main-nav a[href="reservation.html"]::after {
      width: 100%;
    }

    /* Actions √† droite */
    .header-actions {
      display: flex;
      align-items: center;
      gap: 12px;
      flex-shrink: 0;
    }

    .nav-cta {
      background: var(--sb-red);
      padding: 8px 22px;
      border-radius: 999px;
      font-weight: 600;
      font-size: 14px;
      color: #F9FAFB;
      white-space: nowrap;
      box-shadow:
        0 0 0 1px rgba(249,250,251,0.08),
        0 10px 28px rgba(0,0,0,0.7);
      transition: background 0.15s ease, transform 0.15s ease, box-shadow 0.15s ease;
    }

    .nav-cta:hover {
      background: #d55a40;
      transform: translateY(-1px);
      box-shadow:
        0 0 0 1px rgba(249,250,251,0.18),
        0 16px 38px rgba(0,0,0,0.9);
    }

    .cart-icon {
      width: 36px;
      height: 36px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.25);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      cursor: pointer;
      position: relative;
      background: radial-gradient(circle at 30% 0%, rgba(248,250,252,0.16), rgba(15,23,42,0.85));
      backdrop-filter: blur(6px);
    }

    #cart-count {
      position: absolute;
      top: -6px;
      right: -6px;
      background: var(--sb-orange);
      color:#fff;
      border-radius:999px;
      font-size:10px;
      padding: 2px 5px;
      min-width: 18px;
      text-align:center;
    }
    #cart-count:empty { display:none; }

    .burger-button {
      display: none;
      width:36px;
      height:36px;
      border-radius:999px;
      border:1px solid #ffffff33;
      background:transparent;
      color:#fff;
      align-items:center;
      justify-content:center;
      cursor:pointer;
      font-size:20px;
    }

    .mobile-nav {
      display:none;
      position:fixed;
      top:80px;
      left:0;
      right:0;
      background:#020617;
      padding:12px 24px 16px;
      z-index:40;
      border-bottom:1px solid #111827;
    }
    .mobile-nav ul {
      list-style:none;
      padding:0;
      margin:0;
      display:flex;
      flex-direction:column;
      gap:12px;
      font-size:15px;
    }
    .mobile-nav a { color:#fff; }
    .mobile-nav.open { display:block; }

    /* ----------- header responsive (t√©l√©phones / tablettes) ----------- */
    @media screen and (max-width: 1024px) {
      .header-inner {
        padding: 10px 16px;
        gap: 12px;
      }

      .main-nav {
        display: none !important;
      }

      .nav-cta {
        display: none !important;
      }

      .brand-text {
        display: none !important;
      }

      .burger-button {
        display: flex !important;
      }

      .brand-logo {
        width: 72px;
      }
    }

    @media (max-width: 640px) {
      .brand-logo {
        width: 64px;
      }
    }

    /* ---------- HERO R√âSERVATION ---------- */
    .hero-resa {
      position: relative;
      padding: 12rem 0 3.25rem;
      background:
        radial-gradient(circle at 25% 0%, rgba(201,76,53,0.35), transparent 55%),
        radial-gradient(circle at 80% 0%, rgba(37,99,235,0.45), transparent 60%),
        #050814;
      text-align: center;
      overflow: hidden;
    }

    .hero-resa::before {
      content: "‚ô™";
      position: absolute;
      top: 18%;
      left: 12%;
      font-size: 32px;
      color: rgba(148,163,184,0.08);
    }

    .hero-resa::after {
      content: "‚ú¶";
      position: absolute;
      bottom: 16%;
      right: 10%;
      font-size: 30px;
      color: rgba(148,163,184,0.08);
    }

    .hero-inner {
      max-width: 640px;
      margin: 0 auto;
      padding: 0 1.5rem;
      color: var(--sb-text-main);
    }

    .hero-eyebrow {
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: #9CA3AF;
      margin-bottom: 10px;
    }

    .hero-resa h1 {
      margin:0 0 10px;
      font-size: 30px;
    }

    .hero-resa p {
      margin:0;
      font-size:14px;
      color: rgba(249,250,251,0.85);
    }

    /* ---------- MAIN / CARD R√âSERVATION ---------- */
    main {
      padding: 0 0 4rem;
      background: #050814;
    }

    .resa-wrapper {
      padding-top: 2.5rem;
    }

    .resa-card {
      background: var(--sb-card);
      border-radius: 24px;
      padding: 2rem 2rem 2.25rem;
      box-shadow: 0 22px 60px rgba(0,0,0,0.9);
      border: 1px solid rgba(255,255,255,0.06);
      position: relative;
      overflow: hidden;
    }

    .resa-card::after {
      content: "üé§";
      position: absolute;
      right: 18px;
      bottom: 16px;
      font-size: 30px;
      color: rgba(148,163,184,0.1);
      pointer-events: none;
    }

    .resa-card h2 {
      font-size: 20px;
      margin-bottom: 0.75rem;
    }

    .resa-header {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem 1.5rem;
      align-items: flex-end;
      margin-bottom: 1.4rem;
    }

    .resa-dates label {
      font-size: 13px;
      color: #E5E7EB;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .resa-dates input[type="date"] {
      padding: 0.55rem 0.8rem;
      border-radius: 999px;
      border: 1px solid var(--sb-border-soft);
      background: #020617;
      color: #F9FAFB;
      font-size: 13px;
      outline: none;
      min-width: 180px;
    }

    .resa-dates input[type="date"]::-webkit-calendar-picker-indicator {
      filter: invert(1);
    }

    .resa-header button {
      border: none;
      border-radius: 999px;
      padding: 0.65rem 1.4rem;
      background: linear-gradient(90deg, var(--sb-red), var(--sb-orange));
      color: #F9FAFB;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      box-shadow:
        0 0 0 1px rgba(248,250,251,0.12),
        0 14px 30px rgba(0,0,0,0.85);
      transition: transform 0.15s ease, box-shadow 0.15s ease, filter 0.15s ease;
      white-space: nowrap;
    }

    .resa-header button:hover {
      transform: translateY(-1px);
      filter: brightness(1.05);
      box-shadow:
        0 0 0 1px rgba(248,250,251,0.18),
        0 20px 50px rgba(0,0,0,1);
    }

    .resa-note {
      font-size: 12px;
      color: var(--sb-text-muted);
      margin-top: 4px;
    }

    @media (min-width: 901px) {
      .resa-header {
        align-items: flex-start;
      }

      .resa-header button {
        align-self: flex-start;
        margin-top: 1.55rem;
      }
    }

    .table-wrapper {
      margin-top: 1rem;
      border-radius: 18px;
      overflow: hidden;
      border: 1px solid rgba(148,163,184,0.35);
      background: #020617;
      box-shadow: inset 0 0 0 1px rgba(15,23,42,0.8);
      overflow-x: auto;
    }

    .table-scroll-hint {
      font-size: 11px;
      color: var(--sb-text-muted);
      margin-top: 0.5rem;
      margin-bottom: 0.1rem;
      text-align: right;
      display: none;
    }

    .table-scroll-hint .arrow {
      font-size: 14px;
      margin-left: 4px;
    }

    @media (max-width: 768px) {
      .table-scroll-hint {
        display: block;
      }
    }

    table {
      border-collapse: collapse;
      width: 100%;
      min-width: 540px;
      color: #F9FAFB;
    }

    thead {
      background: #020617;
    }

    th, td {
      padding: 0.45rem 0.5rem;
      text-align: center;
      font-size: 12px;
      border-bottom: 1px solid rgba(31,41,55,0.9);
      border-right: 1px solid rgba(31,41,55,0.9);
      white-space: nowrap;
    }

    th:last-child,
    td:last-child {
      border-right: none;
    }

    th {
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #E5E7EB;
      background: linear-gradient(to right, rgba(15,23,42,1), rgba(30,64,175,0.35));
    }

    .hour-cell {
      background: #020617;
      font-weight: 600;
      font-size: 12px;
      color: #E5E7EB;
      position: sticky;
      left: 0;
      z-index: 1;
    }

    .slot-cell {
      transition: background-color 0.15s ease, box-shadow 0.15s ease, transform 0.1s ease, color 0.15s ease;
      cursor: default;
    }

    .slot-free {
      background-color: #022c22;
      color: #ECFDF5;
      cursor: pointer;
    }

    .slot-free:hover {
      background-color: #065f46;
      box-shadow: 0 0 0 1px rgba(16,185,129,0.5);
      transform: translateY(-1px);
    }

    .slot-booked {
      background-color: #7f1d1d;
      color: #FEE2E2;
      cursor: not-allowed;
    }

    .slot-selected {
      background: linear-gradient(135deg, #1d4ed8, #4c1d95);
      color: #F9FAFB;
      cursor: default;
      box-shadow: 0 0 0 1px rgba(129,140,248,0.7);
    }

    .slot-label {
      display: flex;
      flex-direction: column;
      gap: 2px;
      align-items: center;
      justify-content: center;
      line-height: 1.2;
    }

    .slot-price {
      font-weight: 600;
      font-size: 13px;
    }

    .slot-status {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      opacity: 0.9;
    }

    .resa-legend {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem 1.5rem;
      align-items: center;
      margin-top: 0.85rem;
      font-size: 11px;
      color: var(--sb-text-muted);
    }

    .legend-item {
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .legend-dot {
      width: 14px;
      height: 14px;
      border-radius: 4px;
      border: 1px solid rgba(15,23,42,0.9);
    }

    .legend-dot.free {
      background-color: #022c22;
    }

    .legend-dot.booked {
      background-color: #7f1d1d;
    }

    .legend-dot.selected {
      background: linear-gradient(135deg, #1d4ed8, #4c1d95);
    }

    .resa-pricing-rules {
      margin-top: 0.4rem;
      font-size: 11px;
      color: var(--sb-text-muted);
    }

    #message {
      margin-top: 1rem;
      font-size: 12px;
      color: #F9FAFB;
      white-space: pre-line;
      min-height: 1em;
    }

    #message span {
      opacity: 0.9;
    }

    #qrcode {
      margin-top: 0.5rem;
    }

    /* ---------- MODAL DE CONFIRMATION ---------- */
    #slot-modal[hidden] {
      display: none;
    }

    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(15,23,42,0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 60;
      backdrop-filter: blur(4px);
    }

    .modal-dialog {
      background: #020617;
      border-radius: 20px;
      padding: 1.5rem 1.75rem 1.4rem;
      max-width: 420px;
      width: 100%;
      box-shadow: 0 24px 70px rgba(0,0,0,0.95);
      border: 1px solid rgba(248,250,251,0.12);
    }

    .modal-dialog h2 {
      font-size: 18px;
      margin-bottom: 8px;
    }

    .modal-dialog p {
      font-size: 13px;
      color: var(--sb-text-muted);
      margin-bottom: 14px;
    }

    .modal-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: flex-end;
    }

    .modal-actions button {
      border-radius: 999px;
      border: none;
      padding: 0.55rem 1.2rem;
      font-size: 13px;
      cursor: pointer;
      white-space: nowrap;
    }

    #modal-cart {
      background: linear-gradient(90deg, var(--sb-red), var(--sb-orange));
      color: #F9FAFB;
      box-shadow:
        0 0 0 1px rgba(248,250,251,0.12),
        0 16px 40px rgba(0,0,0,0.9);
    }

    #modal-continue {
      background: transparent;
      color: #E5E7EB;
      border: 1px solid rgba(148,163,184,0.6);
    }

    #modal-double {
      background: #111827;
      color: #F9FAFB;
      border: 1px solid rgba(96,165,250,0.6);
    }

    #modal-double:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    /* ---------- FOOTER ---------- */
    footer {
      background:#020617;
      color:#e5e7eb;
      padding:32px 24px 18px;
      border-top: 1px solid #111827;
    }

    .newsletter-container {
      max-width:var(--sb-container-width);
      margin:0 auto 24px;
      text-align:center;
    }
    .newsletter-container h3 { margin-bottom:6px; }
    .newsletter-container p {
      margin-top: 0;
      font-size: 13px;
      color: var(--sb-text-muted);
    }

    .newsletter-row {
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      justify-content:center;
      margin-top: 8px;
    }

    footer input[type=email] {
      padding:10px 12px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,0.4);
      min-width:240px;
      max-width:360px;
      font-size:14px;
      background:#020617;
      color:#F9FAFB;
      outline: none;
    }

    footer input[type=email]::placeholder {
      color: rgba(156,163,175,0.9);
    }

    footer button {
      padding:10px 18px;
      border:none;
      border-radius:999px;
      background:linear-gradient(90deg,var(--sb-red),var(--sb-orange));
      color:#F9FAFB;
      font-weight:600;
      font-size:14px;
      cursor:pointer;
      box-shadow:
        0 0 0 1px rgba(248,250,251,0.12),
        0 16px 40px rgba(0,0,0,0.9);
    }

    .footer-columns {
      max-width:var(--sb-container-width);
      margin:0 auto;
      display:flex;
      flex-wrap:wrap;
      gap:24px;
      justify-content:space-between;
      font-size:13px;
    }

    .footer-brand {
      display:flex;
      align-items:center;
      gap:10px;
    }

    .footer-brand img {
      height:80px;
      width:auto;
      display:block;
    }

    .footer-columns p { margin:4px 0; }

    .footer-social .social-link {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 13px;
      margin: 4px 0;
      color: inherit;
      text-decoration: none;
    }

    .footer-social .social-link:hover {
      color: #f97316;
    }

    .footer-social .social-icon {
      width: 24px;
      height: 24px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }

    .footer-social .social-icon svg {
      width: 100%;
      height: 100%;
      fill: currentColor;
    }

    .footer-bottom {
      max-width:var(--sb-container-width);
      margin:20px auto 0;
      padding-top:8px;
      font-size:11px;
      text-align:center;
      color:#9CA3AF;
      border-top:1px solid #111827;
    }

    /* ---------- RESPONSIVE ---------- */
    @media (max-width: 900px) {
      .resa-card {
        padding: 1.75rem 1.5rem 2rem;
      }
    }

    @media (max-width: 600px) {
      .hero-resa {
        padding-top: 9rem;
      }
      .hero-resa h1 {
        font-size: 26px;
      }
      .resa-header {
        flex-direction: column;
        align-items: flex-start;
      }
      .resa-header button {
        width: 100%;
        text-align: center;
        margin-top: 0.75rem;
      }
    }
  </style>
</head>
<body>

  <!-- HEADER -->
  <header class="site-header">
    <div class="header-inner">
      <a href="index.html" class="brand">
        <img src="logo.png" alt="Logo Singbox, karaok√© box √† Toulouse" class="brand-logo" />
        <span class="brand-text">Singbox</span>
      </a>

      <nav class="main-nav" aria-label="Navigation principale">
        <ul>
          <li><a href="index.html">Accueil</a></li>
          <li><a href="concept.html">Le concept</a></li>
          <li><a href="boxs.html">Les boxs</a></li>
          <li><a href="actualites.html">Actualit√©s</a></li>
          <li><a href="contact.html">Contact</a></li>
          <li><a href="mon-compte.html">Mon compte</a></li>
        </ul>
      </nav>

      <div class="header-actions">
        <a href="reservation.html" class="nav-cta">R√©server</a>
        <a href="panier.html" class="cart-icon" aria-label="Acc√©der au panier">
          üõí<span id="cart-count"></span>
        </a>
        <button class="burger-button" id="burger-button" aria-label="Ouvrir le menu">
          ‚ò∞
        </button>
      </div>
    </div>
  </header>

  <!-- MENU MOBILE -->
  <nav class="mobile-nav" id="mobile-nav" aria-label="Menu mobile">
    <ul>
      <li><a href="index.html">Accueil</a></li>
      <li><a href="concept.html">Le concept</a></li>
      <li><a href="boxs.html">Les boxs</a></li>
      <li><a href="actualites.html">Actualit√©s</a></li>
      <li><a href="contact.html">Contact</a></li>
      <li><a href="mon-compte.html">Mon compte</a></li>
    </ul>
  </nav>

  <!-- HERO -->
  <section class="hero-resa">
    <div class="hero-inner">
      <p class="hero-eyebrow">R√âSERVATION KARAOK√â BOX</p>
      <h1>R√©server votre karaok√© box √† Toulouse</h1>
      <p>
        Choisissez votre date, votre box (Nuit √©toil√©e ou Ambiance Sunset) et cliquez sur un cr√©neau libre
        pour l‚Äôajouter √† votre panier. R√©servation 100&nbsp;% en ligne, 24h/24.
      </p>
    </div>
  </section>

  <main>
    <div class="container resa-wrapper">
      <section class="resa-card" aria-label="Planning de r√©servation des box Singbox">
        <h2>Choisissez votre date et votre cr√©neau de karaok√©</h2>

        <div class="resa-header">
          <div class="resa-dates">
            <label for="date-input">
              Date de votre s√©ance
              <input type="date" id="date-input" />
            </label>
            <p class="resa-note">
              Tarifs dynamiques selon le jour et l‚Äôhoraire : plus t√¥t dans la journ√©e, plus c‚Äôest avantageux.
            </p>
          </div>
          <button id="load-button" type="button">Voir les cr√©neaux disponibles</button>
        </div>

        <!-- Texte d‚Äôaide mobile pour la 2e box -->
        <p class="table-scroll-hint">
          Sur mobile, glissez le tableau vers la droite pour voir l‚Äôautre box
          <span class="arrow">‚ü∂</span>
        </p>

        <div class="table-wrapper">
          <table id="planning-table" aria-label="Tableau des cr√©neaux de r√©servation pour les box Singbox">
            <!-- Table g√©n√©r√©e en JS -->
          </table>
        </div>

        <div class="resa-legend">
          <div class="legend-item">
            <span class="legend-dot free"></span> <span>Libre</span>
          </div>
          <div class="legend-item">
            <span class="legend-dot booked"></span> <span>R√©serv√©</span>
          </div>
          <div class="legend-item">
            <span class="legend-dot selected"></span> <span>Dans ton panier</span>
          </div>
        </div>
        <p class="resa-pricing-rules">
          25&nbsp;‚Ç¨ de 4h √† 14h ‚Äì 30&nbsp;‚Ç¨ en fin d‚Äôapr√®s-midi ‚Äì 35&nbsp;‚Ç¨ en soir√©e et nuit les jeudis / vendredis / samedis / dimanches.
        </p>

        <p id="message"></p>
        <div id="qrcode"></div>
      </section>
    </div>
  </main>

  <!-- MODAL CONFIRMATION CR√âNEAU -->
  <div id="slot-modal" class="modal-backdrop" hidden>
    <div class="modal-dialog" role="dialog" aria-modal="true" aria-labelledby="modal-slot-info">
      <h2>Cr√©neau ajout√© au panier</h2>
      <p id="modal-slot-info"></p>
      <div class="modal-actions">
        <button id="modal-double" type="button">R√©server 2 heures</button>
        <button id="modal-continue" type="button">Continuer ma r√©servation</button>
        <button id="modal-cart" type="button">Valider mon panier</button>
      </div>
    </div>
  </div>

  <!-- FOOTER -->
  <footer>
    <div class="newsletter-container">
      <h3>Inscrivez-vous √† notre newsletter</h3>
      <p>Des playlists, des infos exclusives, des photos d‚Äôambiance‚Ä¶ Tout arrive bient√¥t.</p>
      <div class="newsletter-row">
        <input
          id="newsletter-email"
          type="email"
          placeholder="Entrez votre adresse e-mail"
          required
        />
        <button
          id="newsletter-submit"
          type="button"
        >
          S'abonner aux actualit√©s
        </button>
      </div>
      <p id="newsletter-message" style="font-size:12px;margin-top:6px;min-height:16px;"></p>
    </div>

    <div class="footer-columns">
      <div class="footer-brand">
        <img src="logo.png" alt="Logo Singbox, karaok√© box √† Toulouse" />
        <div>
          <p style="font-weight:700;font-size:16px;margin-bottom:4px;">Singbox</p>
          <p style="margin:0;">Karaok√© Box √† Toulouse</p>
        </div>
      </div>

      <div>
        <p><strong>Infos</strong></p>
        <p><a href="mentions-legales.html">Mentions l√©gales</a></p>
        <p><a href="politique-confidentialite.html">Politique de confidentialit√©</a></p>
        <p><a href="cgv.html">CGV</a></p>
      </div>

      <div>
        <p><strong>Contact</strong></p>
        <p>Adresse : 66 Rue de la R√©publique, 31300 Toulouse</p>
        <p>Email : contactsingbox@gmail.com</p>
        <p>T√©l√©phone : 06 00 00 00 00</p>
      </div>

      <div class="footer-social">
        <p><strong>R√©seaux</strong></p>

        <a
          href="https://www.instagram.com/singboxtoulouse/"
          target="_blank"
          rel="noopener noreferrer"
          class="social-link"
        >
          <span class="social-icon">
            <svg viewBox="0 0 24 24" aria-hidden="true">
              <rect x="3" y="3" width="18" height="18" rx="5" ry="5"
                    fill="none" stroke="currentColor" stroke-width="1.8"></rect>
              <circle cx="12" cy="12" r="4.2"
                      fill="none" stroke="currentColor" stroke-width="1.8"></circle>
              <circle cx="17" cy="7" r="1.2" fill="currentColor"></circle>
            </svg>
          </span>
          <span>Instagram</span>
        </a>

        <a
          href="https://www.tiktok.com/@singbox.toulouse/"
          target="_blank"
          rel="noopener noreferrer"
          class="social-link"
        >
          <span class="social-icon">
            <svg viewBox="0 0 24 24" aria-hidden="true">
              <path d="M15.5 5.1c.7.8 1.6 1.4 2.6 1.7v2.6c-1.1-.1-2.1-.4-3-0.9v5.3c0 2.8-2.3 5.1-5.2 5.1S4.8 16.6 4.8 13.8c0-2.6 1.9-4.8 4.5-5.1v2.7c-1 .3-1.7 1.2-1.7 2.3 0 1.3 1 2.3 2.3 2.3s2.3-1 2.3-2.3V4.5h3.3v.6z"></path>
            </svg>
          </span>
          <span>TikTok</span>
        </a>
      </div>
    </div>

    <div class="footer-bottom">
      R√©alis√© avec ‚ô• pour Singbox
    </div>
  </footer>

  <script>
    const API_BASE = "https://singbox-backend.onrender.com";

    function toLocalYMD(dateObj) {
      const y = dateObj.getFullYear();
      const m = String(dateObj.getMonth() + 1).padStart(2, "0");
      const d = String(dateObj.getDate()).padStart(2, "0");
      return `${y}-${m}-${d}`;
    }

    function getPanier() {
      try {
        return JSON.parse(localStorage.getItem("panier")) || [];
      } catch (e) {
        return [];
      }
    }

    function savePanier(panier) {
      localStorage.setItem("panier", JSON.stringify(panier));
    }

    function updateCartIcon() {
      const el = document.getElementById("cart-count");
      if (!el) return;
      const panier = getPanier();
      el.textContent = panier.length ? panier.length : "";
    }

    function addSlotToCart(boxId, boxName, dateObj, hour, price) {
      const isoDate = toLocalYMD(dateObj);
      const panier = getPanier();

      const exists = panier.some(item =>
        item.type === "reservation" &&
        item.boxId === boxId &&
        item.date === isoDate &&
        item.hour === hour
      );
      if (exists) {
        return;
      }

      panier.push({
        type: "reservation",
        boxId,
        boxName,
        date: isoDate,
        hour,
        price
      });
      savePanier(panier);
      updateCartIcon();

      const msgEl = document.getElementById("message");
      const heureLabel = String(hour).padStart(2, "0") + "h‚Äì" + String((hour + 1) % 24).padStart(2, "0") + "h";
      msgEl.innerHTML = "<span>Cr√©neau ajout√© au panier : <strong>" +
        boxName +
        "</strong> ‚Äì " +
        heureLabel +
        " ‚Äì " +
        price +
        "‚Ç¨</span>";
    }

    function getSlotPrice(date, hour) {
      const day = date.getDay(); // 0 dimanche
      const isWeekendPlus = (day === 0 || day === 4 || day === 5 || day === 6);
      if (hour >= 4 && hour <= 14) {
        return 25;
      }
      if (!isWeekendPlus) {
        return 30;
      }
      if (hour >= 15 && hour <= 19) {
        return 30;
      }
      return 35;
    }

    let bookedIndex = {};

    async function fetchReservationsForDate(isoDate) {
      bookedIndex = {};
      try {
        const res = await fetch(`${API_BASE}/api/slots?date=${isoDate}`);
        if (!res.ok) {
          console.error("Erreur HTTP /api/slots :", res.status);
          return;
        }
        const json = await res.json();
        const reservations = json.reservations || [];

        reservations.forEach(r => {
          const start = new Date(r.start_time);
          const h = start.getHours();
          const boxId = r.box_id;
          const key = `${boxId}-${h}`;
          bookedIndex[key] = true;
        });
      } catch (e) {
        console.error("Erreur fetchReservationsForDate :", e);
      }
    }

    function isSlotBooked(boxId, hour) {
      const key = `${boxId}-${hour}`;
      return !!bookedIndex[key];
    }

    const BOXES = [
      { id: 1, name: "Nuit √©toil√©e" },
      { id: 2, name: "Ambiance Sunset" }
    ];

    let currentPlanningDateIso = null;
    let lastSelectedSlot = null;

    function markCellSelected(td) {
      td.classList.remove("slot-free");
      td.classList.add("slot-selected");
      const statusSpan = td.querySelector(".slot-status");
      if (statusSpan) {
        statusSpan.textContent = "Dans ton panier";
      }
      td.onclick = null;
    }

    function openSlotModal(slot) {
      lastSelectedSlot = slot;
      const modal = document.getElementById("slot-modal");
      const infoEl = document.getElementById("modal-slot-info");

      if (infoEl) {
        const parts = slot.date.split("-");
        const dateStr = parts[2] + "/" + parts[1] + "/" + parts[0];
        const h1 = String(slot.hour).padStart(2, "0");
        const h2 = String((slot.hour + 1) % 24).padStart(2, "0");
        infoEl.textContent =
          slot.boxName + " ‚Äì " + dateStr + " ‚Äì " + h1 + "h‚Äì" + h2 + "h";
      }

      const doubleBtn = document.getElementById("modal-double");
      if (doubleBtn) {
        if (slot.hour >= 23) {
          doubleBtn.disabled = true;
          doubleBtn.textContent = "R√©server 2 heures (indisponible)";
        } else {
          doubleBtn.disabled = false;
          doubleBtn.textContent = "R√©server 2 heures";
        }
      }

      if (modal) {
        modal.removeAttribute("hidden");
      }
    }

    function closeSlotModal() {
      const modal = document.getElementById("slot-modal");
      if (modal) {
        modal.setAttribute("hidden", "true");
      }
    }

    function buildPlanningTable(date) {
      const table = document.getElementById("planning-table");
      if (!table) return;

      const isoDate = toLocalYMD(date);
      currentPlanningDateIso = isoDate;

      const panier = getPanier();
      const hours = Array.from({ length: 24 }, (_, h) => h);
      table.innerHTML = "";

      const thead = document.createElement("thead");
      const headRow = document.createElement("tr");

      const hourTh = document.createElement("th");
      hourTh.textContent = "Heure";
      hourTh.className = "hour-cell";
      headRow.appendChild(hourTh);

      BOXES.forEach(box => {
        const th = document.createElement("th");
        th.textContent = box.name;
        headRow.appendChild(th);
      });

      thead.appendChild(headRow);
      table.appendChild(thead);

      const tbody = document.createElement("tbody");

      hours.forEach(hour => {
        const tr = document.createElement("tr");

        const hourTd = document.createElement("td");
        hourTd.className = "hour-cell";
        const endHour = (hour + 1) % 24;
        hourTd.textContent =
          String(hour).padStart(2, "0") +
          "h‚Äì" +
          String(endHour).padStart(2, "0") +
          "h";
        tr.appendChild(hourTd);

        BOXES.forEach(box => {
          const td = document.createElement("td");
          td.classList.add("slot-cell");
          td.dataset.boxId = String(box.id);
          td.dataset.hour = String(hour);
          td.dataset.date = isoDate;

          const price = getSlotPrice(date, hour);
          const booked = isSlotBooked(box.id, hour);

          const wrapper = document.createElement("div");
          wrapper.className = "slot-label";

          if (booked) {
            td.classList.add("slot-booked");
            const statusSpan = document.createElement("span");
            statusSpan.className = "slot-status";
            statusSpan.textContent = "R√©serv√©";
            wrapper.appendChild(statusSpan);
          } else {
            const alreadyInCart = panier.some(item =>
              item.type === "reservation" &&
              item.boxId === box.id &&
              item.date === isoDate &&
              item.hour === hour
            );

            const priceSpan = document.createElement("span");
            priceSpan.className = "slot-price";
            priceSpan.textContent = price + "‚Ç¨";
            wrapper.appendChild(priceSpan);

            const statusSpan = document.createElement("span");
            statusSpan.className = "slot-status";
            statusSpan.textContent = alreadyInCart
              ? "Dans ton panier"
              : "Libre";
            wrapper.appendChild(statusSpan);

            if (alreadyInCart) {
              td.classList.add("slot-selected");
            } else {
              td.classList.add("slot-free");
              td.onclick = function () {
                const slotInfo = {
                  boxId: box.id,
                  boxName: box.name,
                  date: isoDate,
                  dateObj: date,
                  hour,
                  price
                };
                addSlotToCart(box.id, box.name, date, hour, price);
                markCellSelected(td);
                openSlotModal(slotInfo);
              };
            }
          }

          td.appendChild(wrapper);
          tr.appendChild(td);
        });

        tbody.appendChild(tr);
      });

      table.appendChild(tbody);
    }

    document.addEventListener("DOMContentLoaded", function () {
      const burgerBtn = document.getElementById("burger-button");
      const mobileNav = document.getElementById("mobile-nav");
      if (burgerBtn && mobileNav) {
        burgerBtn.addEventListener("click", () => {
          mobileNav.classList.toggle("open");
        });
        mobileNav.addEventListener("click", (e) => {
          if (e.target.tagName === "A") {
            mobileNav.classList.remove("open");
          }
        });
      }

      updateCartIcon();

      const dateInput = document.getElementById("date-input");
      const loadButton = document.getElementById("load-button");

      const today = new Date();
      const isoToday = toLocalYMD(today);
      dateInput.value = isoToday;

      async function refreshPlanning() {
        if (!dateInput.value) return;

        const iso = dateInput.value;
        const parts = iso.split("-");
        const selectedDate = new Date(
          parseInt(parts[0], 10),
          parseInt(parts[1], 10) - 1,
          parseInt(parts[2], 10)
        );

        await fetchReservationsForDate(iso);
        buildPlanningTable(selectedDate);
        document.getElementById("message").textContent = "";
      }

      loadButton.addEventListener("click", () => {
        refreshPlanning();
      });

      refreshPlanning();

      const continueBtn = document.getElementById("modal-continue");
      const cartBtn = document.getElementById("modal-cart");
      const doubleBtn = document.getElementById("modal-double");

      if (continueBtn) {
        continueBtn.addEventListener("click", () => {
          closeSlotModal();
        });
      }

      if (cartBtn) {
        cartBtn.addEventListener("click", () => {
          window.location.href = "panier.html";
        });
      }

      if (doubleBtn) {
        doubleBtn.addEventListener("click", () => {
          if (!lastSelectedSlot) return;
          const nextHour = lastSelectedSlot.hour + 1;
          if (nextHour >= 24) return;

          const dateObj = lastSelectedSlot.dateObj;
          const price2 = getSlotPrice(dateObj, nextHour);

          const panier = getPanier();
          const exists = panier.some(item =>
            item.type === "reservation" &&
            item.boxId === lastSelectedSlot.boxId &&
            item.date === lastSelectedSlot.date &&
            item.hour === nextHour
          );
          if (exists) {
            doubleBtn.disabled = true;
            doubleBtn.textContent = "D√©j√† dans ton panier";
            return;
          }

          if (isSlotBooked(lastSelectedSlot.boxId, nextHour)) {
            doubleBtn.disabled = true;
            doubleBtn.textContent = "Cr√©neau suivant r√©serv√©";
            return;
          }

          addSlotToCart(
            lastSelectedSlot.boxId,
            lastSelectedSlot.boxName,
            dateObj,
            nextHour,
            price2
          );

          const selector =
            '.slot-cell[data-box-id="' +
            lastSelectedSlot.boxId +
            '"][data-hour="' +
            nextHour +
            '"][data-date="' +
            lastSelectedSlot.date +
            '"]';
          const cell2 = document.querySelector(selector);
          if (cell2) {
            markCellSelected(cell2);
          }

          doubleBtn.disabled = true;
          doubleBtn.textContent = "Deuxi√®me heure ajout√©e ‚úì";
        });
      }
    });
  </script>

  <!-- Supabase Newsletter Script -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const supabaseUrl = "https://sfckofydfqbllkxhxwnt.supabase.co";
      const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNmY2tvZnlkZnFibGxreGh4d250Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQxOTA4ODQsImV4cCI6MjA3OTc2Njg4NH0.2kg7GxQBU8nArCCbJPm0JSn208izXCeiDX266FUC1lw";

      const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);

      const emailInput = document.getElementById("newsletter-email");
      const submitBtn = document.getElementById("newsletter-submit");
      const messageBox = document.getElementById("newsletter-message");

      if (!emailInput || !submitBtn || !messageBox) return;

      submitBtn.addEventListener("click", async () => {
        const email = emailInput.value.trim();

        messageBox.style.color = "#e5e7eb";
        messageBox.textContent = "Envoi en cours...";

        if (!email || !email.includes("@")) {
          messageBox.style.color = "#ff6b6b";
          messageBox.textContent = "Veuillez entrer une adresse e-mail valide.";
          return;
        }

        const { error } = await supabaseClient
          .from("newsletter_subscriptions")
          .insert({ email });

        if (error) {
          if (
            error.code === "23505" ||
            (error.message && error.message.includes("duplicate key value"))
          ) {
            messageBox.style.color = "#38bdf8";
            messageBox.textContent = "Vous √™tes d√©j√† inscrit √† la newsletter üòâ";
          } else {
            messageBox.style.color = "#ff6b6b";
            messageBox.textContent = "Erreur : " + error.message;
          }
        } else {
          messageBox.style.color = "#38bdf8";
          messageBox.textContent = "Merci ! Vous √™tes inscrit üéâ";
          emailInput.value = "";
        }
      });
    });
  </script>

</body>
</html>
