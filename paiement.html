<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Singbox - Panier & Paiement</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=League+Spartan:wght@600;700;800&family=Montserrat:wght@300;400;500;600&display=swap"
    rel="stylesheet"
  >

  <style>
    :root {
      --sb-bg-main: #050814;
      --sb-bg-deep: #020617;
      --sb-bg-soft: #030712;
      --sb-card: #050b18;
      --sb-text-main: #F9FAFB;
      --sb-text-muted: #9CA3AF;
      --sb-red: #C94C35;
      --sb-orange: #F97316;
      --sb-border-soft: rgba(148, 163, 184, 0.35);
      --sb-container-width: 1180px;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: "Montserrat", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: var(--sb-text-main);
      background:
        radial-gradient(circle at 10% 0%, rgba(107,18,32,0.65), transparent 55%),
        radial-gradient(circle at 80% 10%, rgba(30,64,175,0.7), transparent 60%),
        linear-gradient(145deg, #020617 0, #020617 40%, var(--sb-bg-main) 100%);
      min-height: 100vh;
      overflow-x: hidden;
    }

    a { text-decoration: none; color: inherit; }

    h1, h2, h3, h4 {
      font-family: "League Spartan", system-ui, sans-serif;
      letter-spacing: 0.03em;
      margin: 0;
    }

    .container {
      max-width: var(--sb-container-width);
      margin: 0 auto;
      padding: 0 24px;
    }

    /* ======================= HEADER GLOBAL ======================= */

    .site-header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 50;
      background: #020617;
      color: #fff;
      box-shadow: 0 14px 30px rgba(0,0,0,0.75);
      height: auto;
    }

    .header-inner {
      max-width: var(--sb-container-width);
      margin: 0 auto;
      padding: 12px 24px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 2rem;
      height: auto;
      flex-wrap: nowrap;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 12px;
      text-decoration: none;
      flex-shrink: 0;
    }

    .brand-logo {
      width: 110px;
      height: auto;
      border-radius: 999px;
      display: block;
      object-fit: contain;
      filter:
        drop-shadow(0 0 12px rgba(255,255,255,0.16))
        drop-shadow(0 0 20px rgba(201,76,53,0.6));
    }

    .brand-text {
      font-family: "League Spartan", system-ui, sans-serif;
      font-weight: 600;
      letter-spacing: 0.15em;
      font-size: 26px;
      color: #F9FAFB;
      text-transform: uppercase;
      white-space: nowrap;
      display: flex;
      align-items: center;
    }

    nav.main-nav {
      flex: 1;
      display: flex;
      justify-content: center;
      min-width: 0;
    }

    .main-nav ul {
      list-style: none;
      display: flex;
      gap: 32px;
      margin: 0;
      padding: 0;
      font-size: 14px;
    }

    .main-nav a {
      font-weight: 600;
      letter-spacing: 0.3px;
      color: #ffffff;
      text-decoration: none;
      position: relative;
      padding-bottom: 4px;
      white-space: nowrap;
    }

    .main-nav a::after {
      content: "";
      position: absolute;
      left: 0;
      bottom: 0;
      width: 0%;
      height: 2px;
      background: linear-gradient(90deg, #ff6930, #ffb96f);
      transition: width 0.3s ease;
      border-radius: 6px;
    }

    .main-nav a:hover::after {
      width: 100%;
    }

    .main-nav a:hover {
      color: #ffb96f;
      transition: 0.25s ease;
    }

    .main-nav a[href="panier.html"]::after {
      width: 100%;
    }

    .header-actions {
      display: flex;
      align-items: center;
      gap: 12px;
      flex-shrink: 0;
    }

    .nav-cta {
      background: var(--sb-red);
      padding: 8px 22px;
      border-radius: 999px;
      font-weight: 600;
      font-size: 14px;
      color: #F9FAFB;
      white-space: nowrap;
      box-shadow:
        0 0 0 1px rgba(249,250,251,0.08),
        0 10px 28px rgba(0,0,0,0.7);
      transition: background 0.15s ease, transform 0.15s ease, box-shadow 0.15s ease;
    }

    .nav-cta:hover {
      background: #d55a40;
      transform: translateY(-1px);
      box-shadow:
        0 0 0 1px rgba(249,250,251,0.18),
        0 16px 38px rgba(0,0,0,0.9);
    }

    .cart-icon {
      width: 36px;
      height: 36px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.25);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      cursor: pointer;
      position: relative;
      background: radial-gradient(circle at 30% 0%, rgba(248,250,252,0.16), rgba(15,23,42,0.85));
      backdrop-filter: blur(6px);
    }

    #cart-count {
      position: absolute;
      top: -6px;
      right: -6px;
      background: var(--sb-red);
      color:#fff;
      border-radius:999px;
      font-size:10px;
      padding: 2px 5px;
      min-width: 18px;
      text-align:center;
    }
    #cart-count:empty { display:none; }

    .burger-button {
      display: none;
      width: 36px;
      height: 36px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.25);
      background: transparent;
      color:#fff;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 20px;
    }

    .mobile-nav {
      display: none;
      position: fixed;
      top: 70px;
      left: 0;
      right: 0;
      background: #020617;
      padding: 12px 24px 16px;
      z-index: 40;
      border-bottom: 1px solid #111827;
    }

    .mobile-nav ul {
      list-style: none;
      padding: 0;
      margin: 0;
      display: flex;
      flex-direction: column;
      gap: 12px;
      font-size: 15px;
    }

    .mobile-nav a { color:#fff; }
    .mobile-nav.open { display:block; }

    /* --------- HEADER RESPONSIVE --------- */
    @media (max-width: 900px) {
      .header-inner {
        padding: 8px 10px;
        gap: 8px;
      }

      nav.main-nav {
        display: none; /* plus de liens texte */
      }

      .brand-logo {
        width: 58px;
      }

      .brand-text {
        font-size: 15px;
        letter-spacing: 0.11em;
      }

      .nav-cta {
        padding: 6px 12px;
        font-size: 11px;
      }

      .cart-icon,
      .burger-button {
        width: 32px;
        height: 32px;
        font-size: 18px;
      }

      .burger-button {
        display: flex;
      }
    }

    @media (max-width: 480px) {
      .header-inner {
        padding: 8px 8px;
        gap: 6px;
      }

      .brand-logo {
        width: 50px;
      }

      .brand-text {
        font-size: 13px;
        letter-spacing: 0.09em;
      }

      .nav-cta {
        padding: 5px 10px;
        font-size: 10px;
      }

      .cart-icon,
      .burger-button {
        width: 30px;
        height: 30px;
        font-size: 16px;
      }
    }

    /* ======================= SECTION PANIER / PAIEMENT ======================= */

    #checkout {
      position: relative;
      padding: 12rem 0 64px;
      background:
        radial-gradient(circle at 25% 0%, rgba(201,76,53,0.35), transparent 55%),
        radial-gradient(circle at 80% 0%, rgba(37,99,235,0.45), transparent 60%),
        #050814;
      color: var(--sb-text-main);
      overflow: hidden;
    }

    #checkout::before {
      content: "‚ô™";
      position: absolute;
      top: 16%;
      left: 8%;
      font-size: 32px;
      color: rgba(148,163,184,0.08);
      pointer-events: none;
    }

    #checkout::after {
      content: "‚ú¶";
      position: absolute;
      bottom: 14%;
      right: 10%;
      font-size: 30px;
      color: rgba(148,163,184,0.08);
      pointer-events: none;
    }

    .checkout-header {
      max-width: 640px;
      margin: 0 auto 32px;
      text-align: center;
    }

    .checkout-header-eyebrow {
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: #9CA3AF;
      margin-bottom: 8px;
    }

    .checkout-header h1 {
      font-size: 30px;
      margin-bottom: 8px;
    }

    .checkout-header p {
      margin: 0;
      font-size: 14px;
      color: rgba(249,250,251,0.85);
    }

    .checkout-layout {
      display: grid;
      grid-template-columns: minmax(0, 1.6fr) minmax(0, 1fr);
      gap: 1.75rem;
      align-items: flex-start;
    }

    .card {
      background: var(--sb-card);
      border-radius: 24px;
      padding: 1.75rem 1.9rem;
      box-shadow:
        0 24px 60px rgba(0,0,0,0.9),
        0 0 0 1px rgba(148,163,184,0.3);
      border: 1px solid rgba(255,255,255,0.04);
      position: relative;
      overflow: hidden;
    }

    .card::after {
      content: "";
      position: absolute;
      inset: 0;
      pointer-events: none;
      background:
        radial-gradient(circle at 0 0, rgba(148,163,184,0.1), transparent 60%);
      opacity: 0.6;
      mix-blend-mode: soft-light;
    }

    .card > * {
      position: relative;
      z-index: 1;
    }

    .billing-card h2 {
      font-size: 22px;
      margin-bottom: 14px;
    }

    .billing-form-grid-2 {
      display: grid;
      grid-template-columns: minmax(0,1fr) minmax(0,1fr);
      gap: 0.9rem;
      margin-bottom: 0.9rem;
    }

    .billing-field {
      margin-bottom: 0.9rem;
      font-size: 13px;
    }

    .billing-field label {
      display: block;
      margin-bottom: 4px;
      color: #E5E7EB;
    }

    .billing-field input,
    .billing-field select {
      width: 100%;
      font-family: inherit;
      font-size: 13px;
      color: #F9FAFB;
      background: #020617;
      border-radius: 999px;
      border: 1px solid var(--sb-border-soft);
      padding: 0.65rem 0.9rem;
      outline: none;
      transition: border-color 0.16s ease, box-shadow 0.16s ease, background 0.16s ease;
    }

    .billing-field select {
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
      background-image:
        linear-gradient(45deg, transparent 50%, #9CA3AF 50%),
        linear-gradient(135deg, #9CA3AF 50%, transparent 50%);
      background-position:
        calc(100% - 14px) calc(50% - 3px),
        calc(100% - 8px) calc(50% - 3px);
      background-size: 6px 6px, 6px 6px;
      background-repeat: no-repeat;
    }

    .billing-field input::placeholder {
      color: rgba(156,163,175,0.9);
    }

    .billing-field input:focus,
    .billing-field select:focus {
      border-color: var(--sb-orange);
      box-shadow:
        0 0 0 1px rgba(249,115,22,0.9),
        0 0 28px rgba(249,115,22,0.35);
    }

    .billing-type-toggle {
      display: inline-flex;
      padding: 3px;
      border-radius: 999px;
      background: #020617;
      border: 1px solid rgba(148,163,184,0.35);
      margin-bottom: 14px;
      font-size: 12px;
      gap: 4px;
    }

    .billing-type-option {
      position: relative;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 6px 14px;
      border-radius: 999px;
      cursor: pointer;
      color: #E5E7EB;
      transition: background 0.15s ease, color 0.15s ease;
    }

    .billing-type-option input {
      position: absolute;
      opacity: 0;
      pointer-events: none;
    }

    .billing-type-option span {
      position: relative;
    }

    .billing-type-option input:checked + span {
      background: linear-gradient(90deg, var(--sb-red), var(--sb-orange));
      border-radius: 999px;
      padding: 6px 14px;
      box-shadow:
        0 0 0 1px rgba(248,250,251,0.18),
        0 12px 30px rgba(0,0,0,0.9);
    }

    /* ======================= COLONNE DROITE ======================= */

    .summary-column {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .order-card h2 {
      font-size: 20px;
      margin-bottom: 12px;
    }

    .order-lines {
      font-size: 13px;
      border-bottom: 1px solid rgba(31,41,55,0.9);
      padding-bottom: 0.75rem;
      margin-bottom: 0.75rem;
    }

    .order-product-name {
      font-weight: 600;
      margin-bottom: 4px;
    }

    .order-meta {
      margin: 0;
      color: var(--sb-text-muted);
      line-height: 1.5;
    }

    .order-totals {
      font-size: 13px;
      margin-top: 0.5rem;
    }

    .order-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 4px;
    }

    .order-row.total {
      margin-top: 6px;
      padding-top: 6px;
      border-top: 1px solid rgba(31,41,55,0.9);
      font-size: 15px;
      font-weight: 700;
    }

    .order-note {
      font-size: 11px;
      color: var(--sb-text-muted);
      margin-top: 2px;
    }

    /* Code promo bloc */

    .promo-card {
      font-size: 12px;
    }

    .promo-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-bottom: 6px;
    }

    .promo-header span {
      font-weight: 600;
      font-size: 13px;
    }

    .promo-toggle {
      font-size: 12px;
      color: #F97316;
      text-decoration: underline;
      cursor: pointer;
      white-space: nowrap;
      background: transparent;
      border: none;
      padding: 0;
    }

    .promo-toggle:hover {
      text-decoration: none;
    }

    .promo-body {
      margin-top: 6px;
      overflow: hidden;
      max-height: 0;
      transition: max-height 0.25s ease;
    }

    .promo-body.open {
      max-height: 200px;
    }

    .promo-input-group {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-top: 0.25rem;
    }

    .promo-input-group input[type="text"] {
      flex: 1 1 130px;
      min-width: 0;
      padding: 0.5rem 0.8rem;
      border-radius: 999px;
      border: 1px solid var(--sb-border-soft);
      background:#020617;
      color:#F9FAFB;
      font-size: 13px;
      outline:none;
    }

    .promo-input-group input::placeholder {
      color: rgba(156,163,175,0.9);
    }

    .promo-input-group button {
      border-radius: 999px;
      border: none;
      padding: 0.5rem 1.1rem;
      font-size: 12px;
      cursor: pointer;
      background: linear-gradient(90deg, var(--sb-red), var(--sb-orange));
      color: #F9FAFB;
      font-weight: 600;
      white-space: nowrap;
      box-shadow:
        0 0 0 1px rgba(248,250,251,0.08),
        0 12px 30px rgba(0,0,0,0.8);
    }

    .promo-message {
      margin-top: 4px;
      font-size: 11px;
      color: var(--sb-text-muted);
    }

    .promo-message.ok { color:#BBF7D0; }
    .promo-message.error { color:#FCA5A5; }

    /* Paiement */

    .payment-card h3 {
      font-size: 16px;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .payment-logos {
      display: inline-flex;
      gap: 6px;
      align-items: center;
      font-size: 11px;
      margin-bottom: 8px;
    }

    .payment-logo {
      width: 30px;
      height: 20px;
      border-radius: 6px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      font-weight: 700;
      color: #020617;
      background: #FACC15;
    }

    .payment-logo.visa {
      background: #1D4ED8;
      color: #F9FAFB;
    }

    .payment-logo.mc {
      background: linear-gradient(90deg,#F97316,#EF4444);
      color:#F9FAFB;
    }

    .payment-info {
      font-size: 11px;
      color: var(--sb-text-muted);
      line-height: 1.5;
      margin-bottom: 10px;
    }

    .card-element-wrapper {
      margin-bottom: 10px;
    }

    #card-element {
      padding: 0.65rem 0.8rem;
      border-radius: 14px;
      border: 1px solid var(--sb-border-soft);
      background:#020617;
    }

    #card-errors {
      font-size: 11px;
      color:#FCA5A5;
      margin-top:4px;
      min-height:1em;
    }

    .payment-consents {
      display: flex;
      flex-direction: column;
      gap: 6px;
      font-size: 12px;
      margin-top: 8px;
      margin-bottom: 10px;
    }

    .payment-consents label {
      display: flex;
      align-items: flex-start;
      gap: 8px;
      cursor: pointer;
    }

    .payment-consents input[type="checkbox"] {
      margin-top: 2px;
      width: 16px;
      height: 16px;
      border-radius: 4px;
      border: 1px solid var(--sb-border-soft);
      background: #020617;
      accent-color: var(--sb-red);
      flex-shrink: 0;
    }

    .payment-consents a {
      color: #F97316;
      text-decoration: underline;
    }

    .payment-consents a:hover {
      text-decoration: none;
    }

    .payment-warning {
      font-size: 12px;
      border-radius: 14px;
      border: 1px solid rgba(248,113,113,0.8);
      background: rgba(127,29,29,0.65);
      padding: 6px 10px;
      color: #FEE2E2;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .payment-warning span:first-child {
      font-size: 16px;
    }

    .checkout-error {
      font-size: 11px;
      color: #FCA5A5;
      margin-top: 4px;
      min-height: 1em;
    }

    .checkout-success {
      font-size: 11px;
      color: #BBF7D0;
      margin-top: 4px;
      min-height: 1em;
    }

    .checkout-submit {
      display: flex;
      justify-content: stretch;
      margin-top: 8px;
    }

    .checkout-submit button {
      width: 100%;
      border: none;
      border-radius: 999px;
      padding: 0.85rem 1.4rem;
      background: linear-gradient(90deg, var(--sb-red), var(--sb-orange));
      color: #F9FAFB;
      font-weight: 700;
      font-size: 14px;
      cursor: pointer;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      box-shadow:
        0 0 0 1px rgba(248,250,251,0.14),
        0 20px 50px rgba(0,0,0,0.95);
      transition: transform 0.15s ease, box-shadow 0.15s ease, filter 0.15s ease;
    }

    .checkout-submit button:hover:not([disabled]) {
      transform: translateY(-1px);
      filter: brightness(1.05);
      box-shadow:
        0 0 0 1px rgba(248,250,251,0.18),
        0 26px 65px rgba(0,0,0,1);
    }

    .checkout-submit button[disabled] {
      opacity: 0.6;
      cursor: progress;
    }

    /* ======================= FOOTER ======================= */
    footer {
      background:#020617;
      color:#e5e7eb;
      padding:32px 24px 18px;
      border-top: 1px solid #111827;
    }

    .newsletter-container {
      max-width:var(--sb-container-width);
      margin:0 auto 24px;
      text-align:center;
    }

    .newsletter-container h3 {
      margin-bottom: 6px;
    }

    .newsletter-container p {
      margin-top: 0;
      font-size: 13px;
      color: var(--sb-text-muted);
    }

    .newsletter-row {
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      justify-content:center;
      margin-top: 8px;
    }

    footer input[type=email] {
      padding:10px 12px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,0.4);
      min-width:240px;
      max-width:360px;
      font-size:14px;
      background:#020617;
      color:#F9FAFB;
      outline: none;
    }

    footer input[type=email]::placeholder {
      color: rgba(156,163,175,0.9);
    }

    footer button {
      padding:10px 18px;
      border:none;
      border-radius:999px;
      background:linear-gradient(90deg,var(--sb-red),var(--sb-orange));
      color:#F9FAFB;
      font-weight:600;
      font-size:14px;
      cursor:pointer;
      box-shadow:
        0 0 0 1px rgba(248,250,251,0.12),
        0 16px 40px rgba(0,0,0,0.9);
    }

    .footer-columns {
      max-width:var(--sb-container-width);
      margin:0 auto;
      display:flex;
      flex-wrap:wrap;
      gap:24px;
      justify-content:space-between;
      font-size:13px;
    }

    .footer-brand {
      display:flex;
      align-items:center;
      gap:10px;
    }

    .footer-brand img {
      height:80px;
      width:auto;
      display:block;
    }

    .footer-columns p { margin:4px 0; }

    .footer-bottom {
      max-width:var(--sb-container-width);
      margin:20px auto 0;
      padding-top:8px;
      font-size:11px;
      text-align:center;
      color:#9CA3AF;
      border-top:1px solid #111827;
    }

    /* ======================= RESPONSIVE ======================= */

    @media (max-width: 900px) {
      #checkout {
        padding-top: 10rem;
      }

      .checkout-layout {
        grid-template-columns: minmax(0,1fr);
      }
    }

    @media (max-width: 640px) {
      .billing-form-grid-2 {
        grid-template-columns: minmax(0,1fr);
      }

      .card {
        padding: 1.55rem 1.45rem;
      }
    }

    /* ======================= MODAL AUTH FID√âLIT√â ======================= */

    .auth-modal-backdrop {
      position: fixed;
      inset: 0;
      background: radial-gradient(circle at 10% 0%, rgba(15,23,42,0.9), rgba(2,6,23,0.96));
      backdrop-filter: blur(10px);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 80;
      padding: 16px;
    }

    .auth-modal-backdrop.open {
      display: flex;
    }

    .auth-modal {
      width: 100%;
      max-width: 440px;
      background: radial-gradient(circle at 10% 0%, rgba(249,115,22,0.18), transparent 55%),
                  radial-gradient(circle at 90% 0%, rgba(37,99,235,0.22), transparent 60%),
                  #020617;
      border-radius: 24px;
      border: 1px solid rgba(148,163,184,0.45);
      box-shadow:
        0 24px 70px rgba(0,0,0,0.95),
        0 0 0 1px rgba(15,23,42,0.9);
      padding: 20px 22px 18px;
      position: relative;
      overflow: hidden;
    }

    .auth-modal::after {
      content:"";
      position:absolute;
      inset:0;
      pointer-events:none;
      background:
        radial-gradient(circle at 0 0, rgba(248,250,252,0.05), transparent 55%);
      mix-blend-mode: soft-light;
    }

    .auth-modal > * {
      position: relative;
      z-index: 1;
    }

    .auth-modal-eyebrow {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--sb-text-muted);
      margin-bottom: 4px;
    }

    .auth-modal h2 {
      font-size: 20px;
      margin-bottom: 6px;
    }

    .auth-modal-subtext {
      font-size: 12px;
      color: var(--sb-text-muted);
      margin-bottom: 10px;
    }

    .auth-loyalty-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 11px;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(15,23,42,0.9);
      border: 1px solid rgba(248,250,252,0.12);
      margin-bottom: 12px;
    }

    .auth-loyalty-pill span:first-child {
      display:inline-flex;
      align-items:center;
      justify-content:center;
      width:18px;
      height:18px;
      border-radius:999px;
      background:linear-gradient(135deg,var(--sb-red),var(--sb-orange));
      font-size:11px;
    }

    .auth-tabs {
      display:flex;
      gap:6px;
      margin-bottom:10px;
      font-size:12px;
      background:#020617;
      border-radius:999px;
      padding:3px;
      border:1px solid rgba(148,163,184,0.35);
    }

    .auth-tab-btn {
      flex:1;
      border:none;
      border-radius:999px;
      padding:6px 10px;
      background:transparent;
      color:#E5E7EB;
      font-size:12px;
      font-weight:500;
      cursor:pointer;
      transition:background 0.15s ease,color 0.15s ease, box-shadow 0.15s ease;
    }

    .auth-tab-btn.active {
      background: linear-gradient(90deg,var(--sb-red),var(--sb-orange));
      color:#F9FAFB;
      box-shadow:
        0 0 0 1px rgba(248,250,251,0.16),
        0 14px 34px rgba(0,0,0,0.9);
    }

    .auth-form {
      font-size:12px;
      margin-bottom:10px;
    }

    .auth-form.hidden {
      display:none;
    }

    .auth-field {
      margin-bottom:8px;
    }

    .auth-field label {
      display:block;
      margin-bottom:3px;
      color:#E5E7EB;
      font-size:12px;
    }

    .auth-field input {
      width:100%;
      font-family:inherit;
      font-size:12px;
      color:#F9FAFB;
      background:#020617;
      border-radius:999px;
      border:1px solid var(--sb-border-soft);
      padding:0.5rem 0.8rem;
      outline:none;
      transition:border-color 0.16s ease, box-shadow 0.16s ease;
    }

    .auth-field input::placeholder {
      color:rgba(156,163,175,0.9);
    }

    .auth-field input:focus {
      border-color:var(--sb-orange);
      box-shadow:
        0 0 0 1px rgba(249,115,22,0.8),
        0 0 22px rgba(249,115,22,0.25);
    }

    .auth-submit-btn {
      width:100%;
      border:none;
      border-radius:999px;
      padding:0.55rem 1rem;
      background:linear-gradient(90deg,var(--sb-red),var(--sb-orange));
      color:#F9FAFB;
      font-size:12px;
      font-weight:600;
      cursor:pointer;
      letter-spacing:0.06em;
      text-transform:uppercase;
      margin-top:4px;
      box-shadow:
        0 0 0 1px rgba(248,250,251,0.12),
        0 16px 40px rgba(0,0,0,0.9);
      transition:transform 0.15s ease, box-shadow 0.15s ease, filter 0.15s ease;
    }

    .auth-submit-btn:hover {
      transform:translateY(-1px);
      filter:brightness(1.03);
      box-shadow:
        0 0 0 1px rgba(248,250,251,0.18),
        0 22px 52px rgba(0,0,0,1);
    }

    .auth-modal-message {
      min-height:14px;
      font-size:11px;
      margin-bottom:6px;
      color:#FCA5A5;
    }

    .auth-modal-footer {
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:8px;
      margin-top:6px;
      font-size:11px;
      color:var(--sb-text-muted);
    }

    .auth-modal-skip {
      border:none;
      background:transparent;
      color:#9CA3AF;
      font-size:11px;
      cursor:pointer;
      text-decoration:underline;
    }

    .auth-modal-skip:hover {
      color:#E5E7EB;
      text-decoration:none;
    }

    .auth-modal-small {
      font-size:10px;
      color:var(--sb-text-muted);
    }
  </style>
</head>
<body>

  <!-- HEADER -->
  <header class="site-header">
    <div class="header-inner">
      <a href="index.html" class="brand">
        <img src="logo.png" alt="Logo Singbox" class="brand-logo">
        <span class="brand-text">Singbox</span>
      </a>

      <nav class="main-nav">
        <ul>
          <li><a href="index.html">Accueil</a></li>
          <li><a href="concept.html">Le concept</a></li>
          <li><a href="boxs.html">Les boxs</a></li>
          <li><a href="actualites.html">Actualit√©s</a></li>
          <li><a href="contact.html">Contact</a></li>
          <li><a href="reservation.html">R√©server</a></li>
        </ul>
      </nav>

      <div class="header-actions">
        <a href="reservation.html" class="nav-cta">R√©server</a>
        <a href="panier.html" class="cart-icon">
          üõí<span id="cart-count"></span>
        </a>
        <button class="burger-button" id="burger-button" aria-label="Ouvrir le menu">
          ‚ò∞
        </button>
      </div>
    </div>
  </header>

  <!-- MENU MOBILE -->
  <nav class="mobile-nav" id="mobile-nav">
    <ul>
      <li><a href="index.html">Accueil</a></li>
      <li><a href="concept.html">Le concept</a></li>
      <li><a href="boxs.html">Les boxs</a></li>
      <li><a href="actualites.html">Actualit√©s</a></li>
      <li><a href="contact.html">Contact</a></li>
      <li><a href="reservation.html">R√©server</a></li>
    </ul>
  </nav>

  <!-- MODAL CONNEXION / FID√âLIT√â -->
  <div id="auth-modal-backdrop" class="auth-modal-backdrop">
    <div class="auth-modal">
      <div class="auth-modal-eyebrow">Programme fid√©lit√©</div>
      <h2>Connectez-vous avant de payer</h2>
      <p class="auth-modal-subtext">
        Cr√©ez votre compte ou connectez-vous pour cumuler des points √† chaque session.
      </p>
      <div class="auth-loyalty-pill">
        <span>‚òÖ</span>
        <span>10 points par r√©servation payante. √Ä 100 points, votre prochaine s√©ance est offerte.</span>
      </div>

      <div class="auth-tabs">
        <button type="button" id="auth-btn-login" class="auth-tab-btn active">Se connecter</button>
        <button type="button" id="auth-btn-register" class="auth-tab-btn">Cr√©er un compte</button>
      </div>

      <div id="auth-modal-message" class="auth-modal-message"></div>

      <!-- Formulaire LOGIN -->
      <form id="auth-login-form" class="auth-form">
        <div class="auth-field">
          <label for="auth-login-email">Email</label>
          <input type="email" id="auth-login-email" placeholder="vous@email.fr" required>
        </div>
        <div class="auth-field">
          <label for="auth-login-password">Mot de passe</label>
          <input type="password" id="auth-login-password" placeholder="Mot de passe" required>
        </div>
        <button type="submit" class="auth-submit-btn">Connexion</button>
      </form>

      <!-- Formulaire REGISTER -->
      <form id="auth-register-form" class="auth-form hidden">
        <div class="auth-field">
          <label for="auth-register-email">Email</label>
          <input type="email" id="auth-register-email" placeholder="vous@email.fr" required>
        </div>
        <div class="auth-field">
          <label for="auth-register-password">Mot de passe</label>
          <input type="password" id="auth-register-password" placeholder="Mot de passe" required>
        </div>
        <button type="submit" class="auth-submit-btn">Cr√©er mon compte</button>
      </form>

      <div class="auth-modal-footer">
        <button type="button" id="auth-modal-continue" class="auth-modal-skip">
          Continuer sans compte (pas de points)
        </button>
        <span class="auth-modal-small">
          Vous pourrez retrouver vos points et vos r√©servations dans l‚Äôespace ‚ÄúMon compte‚Äù.
        </span>
      </div>
    </div>
  </div>

  <!-- MAIN CHECKOUT -->
  <section id="checkout">
    <div class="container">
      <div class="checkout-header">
        <p class="checkout-header-eyebrow">Panier & paiement</p>
        <h1>Finalisez votre r√©servation</h1>
        <p>V√©rifiez vos informations et votre commande avant de chanter chez Singbox.</p>
      </div>

      <div class="checkout-layout">
        <!-- COLONNE GAUCHE : FACTURATION -->
        <div class="billing-card card">
          <h2>D√©tails de facturation</h2>

          <div class="billing-type-toggle" role="radiogroup" aria-label="Type de client">
            <label class="billing-type-option">
              <input type="radio" name="client_type" value="particulier" checked />
              <span>Un particulier</span>
            </label>
            <label class="billing-type-option">
              <input type="radio" name="client_type" value="entreprise" />
              <span>Une entreprise</span>
            </label>
          </div>

          <form id="billing-form" novalidate>
            <div class="billing-form-grid-2">
              <div class="billing-field">
                <label for="prenom">Pr√©nom *</label>
                <input type="text" id="prenom" name="prenom" placeholder="Pr√©nom" required />
              </div>
              <div class="billing-field">
                <label for="nom">Nom *</label>
                <input type="text" id="nom" name="nom" placeholder="Nom" required />
              </div>
            </div>

            <div class="billing-field">
              <label for="pays">Pays / r√©gion *</label>
              <select id="pays" name="pays" required>
                <option value="FR" selected>France</option>
                <option value="BE">Belgique</option>
                <option value="CH">Suisse</option>
                <option value="other">Autre pays</option>
              </select>
            </div>

            <div class="billing-field">
              <label for="adresse">Num√©ro et nom de rue *</label>
              <input type="text" id="adresse" name="adresse" placeholder="Num√©ro de voie et nom de la rue" required />
            </div>

            <div class="billing-field">
              <label for="complement">B√¢timent, appartement, etc. (facultatif)</label>
              <input type="text" id="complement" name="complement" placeholder="B√¢timent, appartement, lot, etc." />
            </div>

            <div class="billing-form-grid-2">
              <div class="billing-field">
                <label for="cp">Code postal *</label>
                <input type="text" id="cp" name="cp" placeholder="Code postal" required />
              </div>
              <div class="billing-field">
                <label for="ville">Ville *</label>
                <input type="text" id="ville" name="ville" placeholder="Ville" required />
              </div>
            </div>

            <div class="billing-field">
              <label for="telephone">T√©l√©phone *</label>
              <input type="tel" id="telephone" name="telephone" placeholder="T√©l√©phone" required />
            </div>

            <div class="billing-field">
              <label for="email">Adresse e-mail *</label>
              <input type="email" id="email" name="email" placeholder="votre@email.fr" required />
            </div>

            <div class="billing-field">
              <label for="naissance">Date de naissance *</label>
              <input type="date" id="naissance" name="naissance" required />
            </div>
          </form>
        </div>

        <!-- COLONNE DROITE : R√âCAP + PAIEMENT -->
        <div class="summary-column">
          <div class="order-card card">
            <h2>Votre commande</h2>

            <div class="order-lines">
              <div class="order-product-name" id="order-product-name">
                Votre s√©lection Singbox
              </div>
              <p class="order-meta" id="order-meta">
                Les d√©tails de vos cr√©neaux appara√Ætront ici.
              </p>
            </div>

            <div class="order-totals">
              <div class="order-row">
                <span>Sous-total</span>
                <span id="order-subtotal">0‚Ç¨</span>
              </div>
              <div class="order-row">
                <span>TVA (20&nbsp;%) incluse</span>
                <span id="order-tva">0‚Ç¨</span>
              </div>
              <div class="order-row total">
                <span>Total</span>
                <span id="order-total">0‚Ç¨</span>
              </div>
              <p class="order-note">Prix TTC, TVA incluse. R√©glable en une seule fois.</p>
            </div>
          </div>

          <!-- Code promo -->
          <div class="promo-card card">
            <div class="promo-header">
              <span>Code promo</span>
              <button type="button" class="promo-toggle" id="promo-toggle">
                Vous avez un code promo ?
              </button>
            </div>

            <div class="promo-body" id="promo-body">
              <div class="promo-input-group">
                <input type="text" id="promo-code" placeholder="SINGBOX10, NOEL..." autocomplete="off" />
                <button type="button" id="apply-promo">Appliquer</button>
              </div>
              <p id="promo-message" class="promo-message"></p>
            </div>
          </div>

          <!-- Paiement -->
          <div class="payment-card card">
            <h3>üí≥ Paiement s√©curis√©</h3>

            <div class="payment-logos">
              <span class="payment-logo visa">VISA</span>
              <span class="payment-logo mc">MC</span>
            </div>

            <p class="payment-info">
              Vos donn√©es personnelles seront utilis√©es pour le traitement de votre commande, pour le suivi de votre visite sur notre site, et pour d‚Äôautres raisons d√©crites dans notre politique de confidentialit√©.
            </p>

            <div class="card-element-wrapper">
              <div id="card-element"></div>
              <div id="card-errors"></div>
            </div>

            <div class="payment-consents">
              <label>
                <input type="checkbox" id="cgv-checkbox">
                <span>J‚Äôai lu et j‚Äôaccepte les conditions g√©n√©rales de vente.</span>
              </label>
              <label>
                <input type="checkbox" id="rules-checkbox">
                <span>Il est interdit de ramener des boissons ou aliments dans les box.</span>
              </label>
              <label>
                <input type="checkbox" id="newsletter-optin">
                <span>Je souhaite recevoir la newsletter Singbox (offres, playlists, soir√©es √† th√®me).</span>
              </label>
            </div>

            <div class="payment-warning">
              <span>‚ö†Ô∏è</span>
              <span>Merci de respecter cette r√®gle pour garantir la propret√© et la s√©curit√© de toutes les box.</span>
            </div>

            <div id="checkout-error" class="checkout-error"></div>
            <div id="checkout-success" class="checkout-success"></div>

            <div class="checkout-submit">
              <button id="checkout-submit-btn" type="button">
                Commander
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- FOOTER -->
  <footer>
    <div class="newsletter-container">
      <h3>Inscrivez-vous √† notre newsletter</h3>
      <p>Des playlists, des infos exclusives, des photos d‚Äôambiance‚Ä¶ Tout arrive bient√¥t.</p>
      <div class="newsletter-row">
        <input
          id="newsletter-email"
          type="email"
          placeholder="Entrez votre adresse e-mail"
        />
        <button
          id="newsletter-submit"
          type="button"
        >
          S'abonner aux actualit√©s
        </button>
      </div>
      <p id="newsletter-message" style="font-size:12px;margin-top:6px;min-height:16px;"></p>
    </div>

    <div class="footer-columns">
      <div class="footer-brand">
        <img src="logo.png" alt="Logo Singbox" />
        <div>
          <p style="font-weight:700;font-size:16px;margin-bottom:4px;">Singbox</p>
          <p style="margin:0;">Karaok√© Box √† Toulouse</p>
        </div>
      </div>

      <div>
        <p><strong>Infos</strong></p>
        <p><a href="mentions-legales.html">Mentions l√©gales</a></p>
        <p><a href="politique-confidentialite.html">Politique de confidentialit√©</a></p>
        <p><a href="cgv.html">CGV</a></p>
      </div>

      <div>
        <p><strong>Contact</strong></p>
        <p>Adresse : [√† compl√©ter]</p>
        <p>Email : contactsingbox@gmail.com</p>
        <p>T√©l√©phone : 06 00 00 00 00</p>
      </div>

      <div>
        <p><strong>R√©seaux</strong></p>

        <p style="display:flex;align-items:center;gap:8px;">
          <svg width="22" height="22" viewBox="0 0 24 24" aria-hidden="true">
            <rect x="2" y="2" width="20" height="20" rx="5" fill="none" stroke="#F9FAFB" stroke-width="1.6"/>
            <circle cx="12" cy="12" r="5" fill="none" stroke="#F9FAFB" stroke-width="1.6"/>
            <circle cx="17" cy="7" r="1.2" fill="#F9FAFB"/>
          </svg>
          <a href="https://www.instagram.com/singboxtoulouse/" target="_blank" rel="noopener noreferrer">
            Instagram
          </a>
        </p>

        <p style="display:flex;align-items:center;gap:8px;">
          <svg width="22" height="22" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M16 5.5c.7.8 1.6 1.4 2.7 1.6v3a5.1 5.1 0 0 1-3-1v4.3a4.8 4.8 0 1 1-4.7-4.8c.3 0 .6 0 .9.1v3a1.9 1.9 0 1 0 1.4 1.8V4.5h2.7v1z" fill="#F9FAFB"/>
          </svg>
          <a href="https://www.tiktok.com/@singbox.toulouse/" target="_blank" rel="noopener noreferrer">
            TikTok
          </a>
        </p>
      </div>
    </div>

    <div class="footer-bottom">
      R√©alis√© avec ‚ô• pour Singbox
    </div>
  </footer>

  <!-- Stripe -->
  <script src="https://js.stripe.com/v3"></script>

  <script>
    const STRIPE_PUBLISHABLE_KEY = "pk_test_51SYUBK44gpoNdGNgYqQMcppFvT0kViCVEFyDzOQMDz0DR0L71Ob9Kvlh3MO4BFxeRR2bM9VUID7pvrxBoC5GbGSC00Dt8htb3X";
    const PRICE_FALLBACK = 10;

    const API_BASE_URL =
      (window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1")
        ? "http://localhost:3000"
        : "https://singbox-backend.onrender.com";

    let stripe = null;
    let cardElement = null;

    function getPanier() {
      try {
        return JSON.parse(localStorage.getItem("panier")) || [];
      } catch (e) {
        return [];
      }
    }

    function savePanier(panier) {
      localStorage.setItem("panier", JSON.stringify(panier));
    }

    function updateCartIcon() {
      const el = document.getElementById("cart-count");
      if (!el) return;
      const panier = getPanier();
      el.textContent = panier.length ? panier.length : "";
    }

    function computeTotal(panier) {
      return panier.reduce((sum, item) => {
        const p = typeof item.price === "number" ? item.price : PRICE_FALLBACK;
        return sum + p;
      }, 0);
    }

    function formatDateFr(iso) {
      if (!iso) return "";
      try {
        const [y,m,d] = iso.split("-");
        const date = new Date(parseInt(y,10), parseInt(m,10)-1, parseInt(d,10));
        return date.toLocaleDateString("fr-FR", {
          weekday: "long",
          day: "2-digit",
          month: "2-digit",
          year: "numeric"
        });
      } catch {
        return iso;
      }
    }

    function updateOrderSummaryFromPanier() {
      const panier = getPanier();
      const nameEl = document.getElementById("order-product-name");
      const metaEl = document.getElementById("order-meta");
      const subEl = document.getElementById("order-subtotal");
      const tvaEl = document.getElementById("order-tva");
      const totalEl = document.getElementById("order-total");

      if (!nameEl || !metaEl || !subEl || !tvaEl || !totalEl) return;

      if (panier.length === 0) {
        nameEl.textContent = "Aucune r√©servation";
        metaEl.textContent = "Votre panier est vide. Ajoutez des cr√©neaux depuis la page R√©servation.";
        subEl.textContent = "0‚Ç¨";
        tvaEl.textContent = "0‚Ç¨";
        totalEl.textContent = "0‚Ç¨";
        return;
      }

      const totalTTC = computeTotal(panier);
      const totalHT = totalTTC / 1.2;
      const tva = totalTTC - totalHT;

      const first = panier[0];
      const dateLabel = first.date ? formatDateFr(first.date) : "";
      const boxName = first.boxName || first.box || first.boxId || "Box priv√©e";
      let hourText = "";
      if (typeof first.hour === "number") {
        const start = first.hour;
        const end = (first.hour + 1) % 24;
        hourText = String(start).padStart(2,"0") + "h ‚Äì " + String(end).padStart(2,"0") + "h";
      }

      const extraCount = panier.length - 1;

      nameEl.textContent = extraCount > 0
        ? `Box ${boxName} + ${extraCount} autre(s) cr√©neau(x)`
        : `Box ${boxName}`;

      metaEl.innerHTML =
        (dateLabel ? `Date : ${dateLabel}<br>` : "") +
        (hourText ? `Cr√©neau : ${hourText}<br>` : "") +
        `Nombre de cr√©neaux : ${panier.length}`;

      subEl.textContent   = totalHT.toFixed(2).replace(".", ",") + "‚Ç¨";
      tvaEl.textContent   = tva.toFixed(2).replace(".", ",") + "‚Ç¨";
      totalEl.textContent = totalTTC.toFixed(2).replace(".", ",") + "‚Ç¨";
    }

    document.addEventListener("DOMContentLoaded", async function () {
      const burgerBtn = document.getElementById("burger-button");
      const mobileNav = document.getElementById("mobile-nav");

      if (burgerBtn && mobileNav) {
        burgerBtn.addEventListener("click", () => {
          mobileNav.classList.toggle("open");
        });

        mobileNav.addEventListener("click", (e) => {
          if (e.target.tagName === "A") {
            mobileNav.classList.remove("open");
          }
        });
      }

      updateCartIcon();
      updateOrderSummaryFromPanier();

      if (STRIPE_PUBLISHABLE_KEY && window.Stripe) {
        stripe = Stripe(STRIPE_PUBLISHABLE_KEY);

        const elements = stripe.elements({
          appearance: {
            theme: "night",
            variables: {
              colorPrimary: "#F97316",
              colorBackground: "#020617",
              colorText: "#F9FAFB",
              colorTextSecondary: "#E5E7EB",
              colorTextPlaceholder: "#9CA3AF",
              colorIcon: "#F9FAFB",
              colorDanger: "#FCA5A5",
              borderRadius: "14px"
            },
            rules: {
              ".Input": {
                color: "#F9FAFB"
              },
              ".Input::placeholder": {
                color: "#9CA3AF"
              },
              ".Label": {
                color: "#E5E7EB"
              }
            }
          }
        });

        cardElement = elements.create("card", {
          hidePostalCode: true,
          style: {
            base: {
              color: "#F9FAFB",
              iconColor: "#F9FAFB",
              "::placeholder": {
                color: "#9CA3AF"
              }
            },
            invalid: {
              color: "#FCA5A5",
              iconColor: "#FCA5A5"
            }
          }
        });

        cardElement.mount("#card-element");
        cardElement.on("change", function (event) {
          const displayError = document.getElementById("card-errors");
          if (displayError) {
            displayError.textContent = event.error ? event.error.message : "";
          }
        });
      }

      const promoToggle = document.getElementById("promo-toggle");
      const promoBody   = document.getElementById("promo-body");
      const promoInput  = document.getElementById("promo-code");
      const promoBtn    = document.getElementById("apply-promo");
      const promoMsg    = document.getElementById("promo-message");

      if (promoToggle && promoBody) {
        promoToggle.addEventListener("click", () => {
          promoBody.classList.toggle("open");
        });
      }

      function applyPromo() {
        if (!promoInput || !promoMsg) return;
        const code = promoInput.value.trim().toUpperCase();
        promoMsg.classList.remove("ok","error");

        if (!code) {
          promoMsg.textContent = "Saisissez un code promo.";
          promoMsg.classList.add("error");
          localStorage.removeItem("promoCode");
          return;
        }

        if (code === "SINGBOX10") {
          promoMsg.textContent = "Code appliqu√© : la remise sera prise en compte lors du paiement.";
          promoMsg.classList.add("ok");
          localStorage.setItem("promoCode", code);
        } else {
          promoMsg.textContent = "Code promo invalide ou expir√©.";
          promoMsg.classList.add("error");
          localStorage.removeItem("promoCode");
        }
      }

      if (promoBtn) {
        promoBtn.addEventListener("click", applyPromo);
      }
      if (promoInput) {
        promoInput.addEventListener("keydown", (e) => {
          if (e.key === "Enter") {
            e.preventDefault();
            applyPromo();
          }
        });

        const stored = localStorage.getItem("promoCode");
        if (stored) {
          promoInput.value = stored;
          if (promoMsg) {
            promoMsg.textContent = "Code promo m√©moris√© : " + stored;
            promoMsg.classList.add("ok");
          }
        }
      }

      const submitBtn     = document.getElementById("checkout-submit-btn");
      const cgvCheckbox   = document.getElementById("cgv-checkbox");
      const rulesCheckbox = document.getElementById("rules-checkbox");
      const newsletterCheckbox = document.getElementById("newsletter-optin");
      const errorEl       = document.getElementById("checkout-error");
      const successEl     = document.getElementById("checkout-success");
      const billingForm   = document.getElementById("billing-form");

      if (submitBtn) {
        submitBtn.addEventListener("click", async () => {
          if (!billingForm) return;
          if (!stripe || !cardElement) {
            if (errorEl) errorEl.textContent = "Erreur de paiement : Stripe n‚Äôest pas initialis√©.";
            return;
          }

          const panier = getPanier();
          if (!panier || panier.length === 0) {
            if (errorEl) errorEl.textContent = "Votre panier est vide.";
            return;
          }

          const valid = billingForm.reportValidity();
          if (!valid) {
            if (errorEl) errorEl.textContent = "Merci de compl√©ter tous les champs obligatoires de facturation.";
            return;
          }

          if (!cgvCheckbox || !cgvCheckbox.checked) {
            if (errorEl) errorEl.textContent = "Vous devez accepter les conditions g√©n√©rales de vente pour continuer.";
            return;
          }

          if (!rulesCheckbox || !rulesCheckbox.checked) {
            if (errorEl) errorEl.textContent = "Merci de confirmer que vous respecterez les r√®gles dans les box.";
            return;
          }

          if (errorEl) errorEl.textContent = "";
          if (successEl) successEl.textContent = "";

          const prenom     = document.getElementById("prenom").value.trim();
          const nom        = document.getElementById("nom").value.trim();
          const email      = document.getElementById("email").value.trim();
          const telephone  = document.getElementById("telephone").value.trim();
          const pays       = document.getElementById("pays").value;
          const adresse    = document.getElementById("adresse").value.trim();
          const complement = document.getElementById("complement").value.trim();
          const cp         = document.getElementById("cp").value.trim();
          const ville      = document.getElementById("ville").value.trim();
          const naissance  = document.getElementById("naissance").value;

          const promoCode  = localStorage.getItem("promoCode") || null;

          const customer = {
            prenom, nom, email, telephone,
            pays, adresse, complement, cp, ville, naissance,
          };

          submitBtn.disabled = true;
          const originalLabel = submitBtn.textContent;
          submitBtn.textContent = "Paiement en cours...";

          try {
            const res = await fetch(`${API_BASE_URL}/api/create-payment-intent`, {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                panier,
                customer,
                promoCode
              })
            });

            const json = await res.json();
            if (!res.ok || !json.clientSecret) {
              if (errorEl) {
                errorEl.textContent = json.error || "Erreur lors de la cr√©ation du paiement.";
              }
              submitBtn.disabled = false;
              submitBtn.textContent = originalLabel;
              return;
            }

            const clientSecret = json.clientSecret;

            const result = await stripe.confirmCardPayment(clientSecret, {
              payment_method: {
                card: cardElement,
                billing_details: {
                  name: prenom + " " + nom,
                  email: email,
                }
              }
            });

            if (result.error) {
              if (errorEl) errorEl.textContent = result.error.message;
              submitBtn.disabled = false;
              submitBtn.textContent = originalLabel;
              return;
            }

            if (result.paymentIntent && result.paymentIntent.status === "succeeded") {
              if (successEl) {
                successEl.textContent = "Paiement accept√© ‚úîÔ∏è Votre r√©servation va √™tre confirm√©e.";
              }

              try {
                await fetch(`${API_BASE_URL}/api/confirm-reservation`, {
                  method: "POST",
                  headers: { "Content-Type": "application/json" },
                  body: JSON.stringify({
                    panier,
                    customer,
                    promoCode,
                    paymentIntentId: result.paymentIntent.id
                  })
                });
              } catch (e) {
                // on ne bloque pas l'affichage client si la notif backend √©choue
              }

              // Si le client a coch√© la case newsletter, on ajoute son e-mail
              if (newsletterCheckbox && newsletterCheckbox.checked && window.supabaseClient) {
                try {
                  await window.supabaseClient
                    .from("newsletter_subscriptions")
                    .insert({ email });
                } catch (e) {
                  console.error("Erreur inscription newsletter :", e);
                }
              }

              savePanier([]);
              localStorage.removeItem("promoCode");
              updateCartIcon();
              updateOrderSummaryFromPanier();
            }

          } catch (err) {
            if (errorEl) errorEl.textContent = "Erreur inattendue : " + err.message;
          } finally {
            submitBtn.disabled = false;
            submitBtn.textContent = originalLabel;
          }
        });
      }
    });
  </script>

  <!-- POPUP AUTH / FID√âLIT√â JS -->
  <script>
    function showAuthModal() {
      const backdrop = document.getElementById("auth-modal-backdrop");
      if (backdrop) backdrop.classList.add("open");
    }

    function hideAuthModal() {
      const backdrop = document.getElementById("auth-modal-backdrop");
      if (backdrop) backdrop.classList.remove("open");
    }

    function initAuthModal() {
      const backdrop = document.getElementById("auth-modal-backdrop");
      if (!backdrop) return;

      const token = localStorage.getItem("token");
      if (!token) {
        showAuthModal(); // ouverture d√®s l'arriv√©e sur la page si pas connect√©
      }

      const btnLoginTab    = document.getElementById("auth-btn-login");
      const btnRegisterTab = document.getElementById("auth-btn-register");
      const loginForm      = document.getElementById("auth-login-form");
      const registerForm   = document.getElementById("auth-register-form");
      const msgEl          = document.getElementById("auth-modal-message");
      const skipBtn        = document.getElementById("auth-modal-continue");

      if (btnLoginTab && btnRegisterTab && loginForm && registerForm) {
        btnLoginTab.addEventListener("click", () => {
          btnLoginTab.classList.add("active");
          btnRegisterTab.classList.remove("active");
          loginForm.classList.remove("hidden");
          registerForm.classList.add("hidden");
          if (msgEl) msgEl.textContent = "";
        });

        btnRegisterTab.addEventListener("click", () => {
          btnRegisterTab.classList.add("active");
          btnLoginTab.classList.remove("active");
          registerForm.classList.remove("hidden");
          loginForm.classList.add("hidden");
          if (msgEl) msgEl.textContent = "";
        });
      }

      if (skipBtn) {
        skipBtn.addEventListener("click", () => {
          hideAuthModal(); // continue sans compte, pas de points
        });
      }

      if (loginForm) {
        loginForm.addEventListener("submit", async (e) => {
          e.preventDefault();
          if (msgEl) msgEl.textContent = "";
          const email = document.getElementById("auth-login-email").value.trim();
          const password = document.getElementById("auth-login-password").value;

          if (!email || !password) {
            if (msgEl) msgEl.textContent = "Merci de renseigner vos identifiants.";
            return;
          }

          try {
            const res = await fetch(`${API_BASE_URL}/api/login`, {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ email, password })
            });

            const data = await res.json();
            if (!res.ok) {
              if (msgEl) msgEl.textContent = data.error || "Erreur de connexion.";
              return;
            }

            localStorage.setItem("token", data.token);
            hideAuthModal();
          } catch (err) {
            console.error(err);
            if (msgEl) msgEl.textContent = "Erreur r√©seau. Veuillez r√©essayer.";
          }
        });
      }

      if (registerForm) {
        registerForm.addEventListener("submit", async (e) => {
          e.preventDefault();
          if (msgEl) msgEl.textContent = "";
          const email = document.getElementById("auth-register-email").value.trim();
          const password = document.getElementById("auth-register-password").value;

          if (!email || !password) {
            if (msgEl) msgEl.textContent = "Merci de renseigner un email et un mot de passe.";
            return;
          }

          try {
            const res = await fetch(`${API_BASE_URL}/api/register`, {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ email, password })
            });

            const data = await res.json();
            if (!res.ok) {
              if (msgEl) msgEl.textContent = data.error || "Erreur lors de la cr√©ation du compte.";
              return;
            }

            // connexion automatique apr√®s inscription
            const loginRes = await fetch(`${API_BASE_URL}/api/login`, {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ email, password })
            });
            const loginData = await loginRes.json();
            if (loginRes.ok) {
              localStorage.setItem("token", loginData.token);
              hideAuthModal();
            } else {
              if (msgEl) msgEl.textContent = "Compte cr√©√©, mais la connexion a √©chou√©. Essayez via la connexion.";
            }
          } catch (err) {
            console.error(err);
            if (msgEl) msgEl.textContent = "Erreur r√©seau. Veuillez r√©essayer.";
          }
        });
      }
    }

    document.addEventListener("DOMContentLoaded", initAuthModal);
  </script>

  <!-- Supabase Newsletter -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    const SUPABASE_URL = "https://sfckofydfqbllkxhxwnt.supabase.co";
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNmY2tvZnlkZnFibGxreGh4d250Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQxOTA4ODQsImV4cCI6MjA3OTc2Njg4NH0.2kg7GxQBU8nArCCbJPm0JSn208izXCeiDX266FUC1lw";

    window.supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    document.addEventListener("DOMContentLoaded", () => {
      const emailInput = document.getElementById("newsletter-email");
      const submitBtn = document.getElementById("newsletter-submit");
      const messageBox = document.getElementById("newsletter-message");

      if (!emailInput || !submitBtn || !messageBox) return;

      submitBtn.addEventListener("click", async () => {
        const email = emailInput.value.trim();

        messageBox.style.color = "#e5e7eb";
        messageBox.textContent = "Envoi en cours...";

        if (!email || !email.includes("@")) {
          messageBox.style.color = "#ff6b6b";
          messageBox.textContent = "Veuillez entrer une adresse e-mail valide.";
          return;
        }

        const { error } = await window.supabaseClient
          .from("newsletter_subscriptions")
          .insert({ email });

        if (error) {
          if (
            error.code === "23505" ||
            (error.message && error.message.includes("duplicate key value"))
          ) {
            messageBox.style.color = "#38bdf8";
            messageBox.textContent = "Vous √™tes d√©j√† inscrit √† la newsletter üòâ";
          } else {
            messageBox.style.color = "#ff6b6b";
            messageBox.textContent = "Erreur : " + error.message;
          }
        } else {
          messageBox.style.color = "#38bdf8";
          messageBox.textContent = "Merci ! Vous √™tes inscrit üéâ";
          emailInput.value = "";
        }
      });
    });
  </script>

</body>
</html>
